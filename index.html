<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ã–zel Ders Takip Sistemi</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Firebase yapÄ±landÄ±rman
  const firebaseConfig = {
    apiKey: "AIzaSyD4Ctf-F5BSU_4fHK2WgTQUj_okrzyI7OI",
    authDomain: "birebir-1df98.firebaseapp.com",
    databaseURL: "https://birebir-1df98-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "birebir-1df98",
    storageBucket: "birebir-1df98.firebasestorage.app",
    messagingSenderId: "145327250159",
    appId: "1:145327250159:web:f4d8be51e312f5552f591a",
    measurementId: "G-8CB54NS9QW"
  };

  // Firebase'i baÅŸlat
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
</script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      color: #333;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tabs button {
  font-size: 11px;         /* kÃ¼Ã§Ã¼ltÃ¼ldÃ¼ */
  line-height: 1.2;
  white-space: normal;
  width: 90px;             /* biraz daraltÄ±ldÄ± */
  padding: 6px 4px;        /* daha sÄ±kÄ± kenarlar */
}
    .tabs button.active {
      border-color: #333;
      background: #ddd;
    }
    section {
      display: none;
      background: white;
      border-radius: 10px;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    section.active {
      display: block;
    }
    input, select, textarea, button {
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #ddd;
    }
    .btn-small {
      width: auto;
      margin: 0 5px;
      padding: 6px 12px;
    }
    .icon {
      font-size: 16px;
      margin-right: 5px;
    }
    .student-entry {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    .student-entry span {
      flex: 1;
      text-align: left;
    }
    #guncelleModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      display: none;
      z-index: 1000;
      width: 90%;
      max-width: 400px;
    }
    #modalArkaPlan {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      display: none;
      z-index: 999;
    }
    #haftalikKayitListesi,
#odevListesi {
  max-height: 300px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  background: #fafafa;
}
#qrCanvasContainer {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 10px auto;
  width: 100%;
}

  </style>
</head>
<body>
  <h1>ğŸ“˜ Ã–zel Ders Takip Sistemi</h1>  <div class="tabs">
 <button class="tabBtn" onclick="switchTab('ogrenciKayit', this)">ğŸ‘¤ Ã–ÄŸrenci KaydÄ±</button>
<button class="tabBtn" onclick="switchTab('haftalikDegerlendirme', this)">ğŸ“… HaftalÄ±k DeÄŸerlendirme</button>
<button class="tabBtn" onclick="switchTab('whatsappRapor', this)">ğŸ“¤ WhatsApp Rapor</button>
  </div>  <section id="ogrenciKayit" class="active">
    <h2>ğŸ‘¤ Ã–ÄŸrenci KaydÄ±</h2>
    <input type="text" id="ogrenciAd" placeholder="Ã–ÄŸrenci AdÄ±">
    <select id="ogrenciSinif">
      <option value="">SÄ±nÄ±f SeÃ§iniz</option>
      <option value="5. SÄ±nÄ±f">5. SÄ±nÄ±f</option>
      <option value="6. SÄ±nÄ±f">6. SÄ±nÄ±f</option>
      <option value="7. SÄ±nÄ±f">7. SÄ±nÄ±f</option>
      <option value="8. SÄ±nÄ±f">8. SÄ±nÄ±f</option>
    </select>
    <div style="display: flex; gap: 10px;">
      <button onclick="ogrenciEkle()">â• Ã–ÄŸrenci Ekle</button>
      <button onclick="temizleInputlar()">ğŸ”„ Yenile</button>
    </div>
    <div id="ogrenciListesi"></div>
    <hr>
<h3>ğŸ“˜ Ã–dev Ekle</h3>

<select id="odevOgrenci">
  <option value="">Ã–ÄŸrenci SeÃ§iniz</option>
</select>

<input type="date" id="odevTarih">
<textarea id="odevIcerik" placeholder="Ã–dev iÃ§eriÄŸi girin..."></textarea>

<div style="display: flex; gap: 10px;">
  <button onclick="odevEkle()">â• Ã–dev Ekle</button>
  <button onclick="odevFormTemizle()">ğŸ”„ Yenile</button>
  <button onclick="tumOdevleriSil()">ğŸ—‘ï¸ TÃ¼m Ã–devleri Sil</button>
</div>

<div id="odevListesi"></div>
  </section>  
  <div id="modalArkaPlan" onclick="modalKapat()"></div>
  <div id="guncelleModal">
    <h3>âœï¸ Ã–ÄŸrenci GÃ¼ncelle</h3>
    <input type="text" id="guncelleAd">
    <select id="guncelleSinif">
      <option value="">SÄ±nÄ±f SeÃ§iniz</option>
      <option value="5. SÄ±nÄ±f">5. SÄ±nÄ±f</option>
      <option value="6. SÄ±nÄ±f">6. SÄ±nÄ±f</option>
      <option value="7. SÄ±nÄ±f">7. SÄ±nÄ±f</option>
      <option value="8. SÄ±nÄ±f">8. SÄ±nÄ±f</option>
    </select>
    <button onclick="ogrenciGuncelleKaydet()">ğŸ’¾ Kaydet</button>
    <button onclick="modalKapat()">âŒ Kapat</button>
  </div>  
  <section id="haftalikDegerlendirme">
  <h2>ğŸ“… HaftalÄ±k DeÄŸerlendirme</h2>

  <select id="haftaOgrenci">
    <option value="">Ã–ÄŸrenci SeÃ§in</option>
  </select>

  <select id="haftaOdev">
    <option value="">Ã–dev SeÃ§in</option>
  </select>

  <select id="odevDurumu">
    <option value="">Ã–dev Durumu</option>
    <option value="yapti">âœ… YaptÄ±</option>
    <option value="yapmadi">âŒ YapmadÄ±</option>
    <option value="eksik">âš ï¸ Eksik</option>
    <option value="getirmedi">ğŸ“­ Getirmedi</option>
  </select>

  <textarea id="buHaftaKonu" placeholder="Bu hafta iÅŸlenen konu"></textarea>
  <textarea id="gelecekHaftaOdev" placeholder="Gelecek haftanÄ±n Ã¶devi"></textarea>
  <input type="date" id="gelecekTarih">
  <textarea id="gelecekHaftaKonu" placeholder="Gelecek hafta iÅŸlenecek konu"></textarea>

 <button type="button" onclick="haftalikVeriyiEkle()">â• Ã–devi Sisteme Ekle</button>
  <button onclick="haftalikVeriyiKaydet()">ğŸ’¾ TÃ¼mÃ¼nÃ¼ Kaydet</button>
  <button onclick="haftalikFormYenile()">ğŸ”„ Yenile</button>
<hr>
<h3>ğŸ“‹ KayÄ±tlÄ± HaftalÄ±k DeÄŸerlendirmeler</h3>
<button type="button" onclick="tumHaftalikKayitlariSil()">ğŸ—‘ï¸ TÃ¼m KayÄ±tlarÄ± Sil</button>
<div id="haftalikKayitListesi"></div>
  <p id="haftaDurumMesaji"></p>
</section>
  <div id="odevModalArkaPlan" onclick="odevModalKapat()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999;"></div>

<div id="odevGuncelleModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; padding:20px; border-radius:10px; max-width:400px; width:90%; z-index:1000;">
  <h3>âœï¸ Ã–dev GÃ¼ncelle</h3>
  <input type="date" id="guncelleOdevTarih">
  <textarea id="guncelleOdevIcerik" rows="4"></textarea>
  <button onclick="odevGuncelleKaydet()">ğŸ’¾ Kaydet</button>
  <button onclick="odevModalKapat()">âŒ Kapat</button>
</div>
  <!-- WhatsApp Rapor Sekmesi BaÅŸlangÄ±cÄ± -->
  <section id="whatsappRapor">
  <h2>ğŸ“¤ WhatsApp RaporlarÄ±</h2>  <div style="margin-bottom: 20px;">
    <label for="raporTipi"><strong>Rapor TÃ¼rÃ¼:</strong></label>
    <select id="raporTipi" onchange="raporTipiDegisti()">
      <option value="haftalik">ğŸ“… HaftalÄ±k Rapor</option>
      <option value="aylik">ğŸ“† AylÄ±k Rapor</option>
    </select>
  </div>  <!-- Ortak Ã–ÄŸrenci SeÃ§imi -->  <div style="margin-bottom: 15px;">
    <label for="raporOgrenciSec">ğŸ‘¤ Ã–ÄŸrenci SeÃ§:</label>
    <select id="raporOgrenciSec"></select>
  </div> 
    <!-- Mesaj Ã–nizleme AlanÄ± -->  <div>
    <label><strong>ğŸ“„ OluÅŸturulan Mesaj:</strong></label>
    <textarea id="raporMesaj" rows="12"></textarea></div>  <!-- GÃ¶nder Butonu -->
    <button onclick="whatsappMesajGonder()">ğŸ“¤ GÃ¶nder</button>
    <button onclick="raporFormYenile()">ğŸ”„ Yenile</button>
    <button onclick="qrKodModalAc()">ğŸ“± QR Kod ile GÃ¶ster</button>
<div id="qrCanvasContainer"></div>
</section>
<!-- WhatsApp Rapor Sekmesi Sonu -->
  <!-- HaftalÄ±k KayÄ±t GÃ¼ncelle ModalÄ± -->
<div id="haftalikModalArkaPlan" onclick="haftalikModalKapat()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999;"></div>

<div id="haftalikGuncelleModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; padding:20px; border-radius:10px; max-width:450px; width:90%; z-index:1000;">
  <h3>âœï¸ HaftalÄ±k KayÄ±t GÃ¼ncelle</h3>
  <input type="text" id="guncelleHaftaOgrenci" placeholder="Ã–ÄŸrenci AdÄ±">
  <input type="text" id="guncelleHaftaKonu" placeholder="Bu hafta konusu">
  <input type="text" id="guncelleHaftaOdev" placeholder="Ã–dev">
  <input type="text" id="guncelleHaftaDurum" placeholder="Ã–dev durumu (yapti, yapmadi...)">
  <input type="date" id="guncelleHaftaTarih">
  <input type="text" id="guncelleGelecekKonu" placeholder="Gelecek hafta konusu">
  <input type="text" id="guncelleGelecekOdev" placeholder="Gelecek hafta Ã¶devi">
  <button onclick="haftalikKaydiGuncelleKaydet()">ğŸ’¾ Kaydet</button>
  <button onclick="haftalikModalKapat()">âŒ Kapat</button>
</div>

  <script>
    function tumHaftalikKayitlariSil() {
  if (confirm("TÃ¼m haftalÄ±k kayÄ±tlarÄ± silmek istediÄŸinize emin misiniz?")) {
    database.ref("haftalikDegerlendirme").remove()
      .then(() => {
        haftalikKayitlariListele();
        alert("âœ… TÃ¼m haftalÄ±k kayÄ±tlar silindi.");
      })
      .catch(error => {
        console.error("KayÄ±tlar silinemedi:", error);
        alert("âŒ KayÄ±tlar silinemedi.");
      });
  }
}

function qrKodModalAc() {
  const mesaj = document.getElementById('raporMesaj').value.trim();
  if (!mesaj) return alert("Mesaj boÅŸ.");
  const url = `https://wa.me/?text=${encodeURIComponent(mesaj)}`;

  const container = document.getElementById('qrCanvasContainer');
  container.innerHTML = '';
  new QRCode(container, {
    text: url,
    width: 250,
    height: 250,
    correctLevel: QRCode.CorrectLevel.M
  });

  document.getElementById('qrModalArkaPlan').style.display = 'block';
  document.getElementById('qrModal').style.display = 'block';
}

    
   function raporFormYenile() {
  document.getElementById('raporTipi').value = 'haftalik';
  document.getElementById('raporOgrenciSec').value = '';
  document.getElementById('raporMesaj').value = '';
}

   
  let guncellenecekHaftaKey = null;

function haftalikKaydiGuncelle(key, veri) {
  guncellenecekHaftaKey = key;

  document.getElementById('guncelleHaftaOgrenci').value = veri.ogrenci || '';
  document.getElementById('guncelleHaftaOdev').value = veri.odev || '';
  document.getElementById('guncelleHaftaDurum').value = veri.durum || '';
  document.getElementById('guncelleHaftaKonu').value = veri.konu || '';
  document.getElementById('guncelleHaftaTarih').value = veri.tarih || '';
  document.getElementById('guncelleGelecekOdev').value = veri.gelecekOdev || '';
  document.getElementById('guncelleGelecekKonu').value = veri.gelecekKonu || '';

  document.getElementById("haftalikModalArkaPlan").style.display = "block";
  document.getElementById("haftalikGuncelleModal").style.display = "block";
}




function haftalikKaydiGuncelleKaydet() {
  if (!guncellenecekHaftaKey) {
    alert("GÃ¼ncellenecek kayÄ±t yok.");
    return;
  }

  const veri = {
    ogrenci: document.getElementById('guncelleHaftaOgrenci').value,
    odev: document.getElementById('guncelleHaftaOdev').value,
    durum: document.getElementById('guncelleHaftaDurum').value,
    konu: document.getElementById('guncelleHaftaKonu').value,
    tarih: document.getElementById('guncelleHaftaTarih').value,
    gelecekOdev: document.getElementById('guncelleGelecekOdev').value,
    gelecekKonu: document.getElementById('guncelleGelecekKonu').value,
    zaman: new Date().toISOString()
  };

  database.ref("haftalikDegerlendirme/" + guncellenecekHaftaKey).update(veri)
    .then(() => {
      haftalikModalKapat();
      haftalikKayitlariListele();
      alert("âœ… KayÄ±t gÃ¼ncellendi.");
    })
    .catch(err => {
      console.error("GÃ¼ncelleme hatasÄ±:", err);
      alert("âŒ GÃ¼ncelleme baÅŸarÄ±sÄ±z.");
    });
}



function haftalikModalKapat() {
  document.getElementById("haftalikModalArkaPlan").style.display = "none";
  document.getElementById("haftalikGuncelleModal").style.display = "none";
  guncellenecekHaftaKey = null;
}

  
function haftalikKaydiSil(key) {
  if (confirm("Bu haftalÄ±k kaydÄ± silmek istiyor musunuz?")) {
    database.ref("haftalikDegerlendirme/" + key).remove()
      .then(() => haftalikKayitlariListele());
  }
}


  
function haftalikKayitlariListele() {
  const liste = document.getElementById("haftalikKayitListesi");
  liste.innerHTML = "";

  database.ref("haftalikDegerlendirme").once("value")
    .then(snapshot => {
      const veriler = snapshot.val();
      if (!veriler) return;

      Object.entries(veriler).forEach(([key, veri]) => {
        const div = document.createElement("div");
        div.className = "student-entry";

        const metin = `${veri.ogrenci || '???'} - ${veri.tarih || '???'} - ${veri.konu || '???'}`;
        const span = document.createElement("span");
        span.textContent = metin;

        const silBtn = document.createElement("button");
        silBtn.className = "btn-small";
        silBtn.textContent = "ğŸ—‘ï¸";
        silBtn.onclick = () => haftalikKaydiSil(key);

        const guncelleBtn = document.createElement("button");
        guncelleBtn.className = "btn-small";
        guncelleBtn.textContent = "âœï¸";
        guncelleBtn.onclick = () => haftalikKaydiGuncelle(key, veri);

        div.appendChild(span);
        div.appendChild(guncelleBtn);
        div.appendChild(silBtn);
        liste.appendChild(div);
      });
    });
}



  
  function raporTipiDegisti() {
  const raporTipi = document.getElementById('raporTipi').value;
  const aylikSecimAlani = document.getElementById('aylikSecimAlani');
  aylikSecimAlani.style.display = (raporTipi === 'aylik') ? 'block' : 'none';
  raporMesajiOlustur();
}

function whatsappMesajGonder() {
  const mesaj = document.getElementById('raporMesaj').value.trim();
  if (!mesaj) return alert('GÃ¶nderilecek mesaj boÅŸ.');
  const url = `https://wa.me/?text=${encodeURIComponent(mesaj)}`;
  window.open(url, '_blank');
}

function raporMesajiOlustur() {
  const tip = document.getElementById('raporTipi').value;
  const secilenId = document.getElementById('raporOgrenciSec').value;
  if (!secilenId) return;

  const ayAdlari = ['Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];
  const formatTarih = (date) => `${date.getDate()} ${ayAdlari[date.getMonth()]} ${date.getFullYear()}`;
  const toShortDateStr = (d) => new Date(d).toISOString().split('T')[0];

  const bugun = new Date();
  const bugunStr = toShortDateStr(bugun);
  const birAyOnce = new Date(bugun);
  birAyOnce.setMonth(birAyOnce.getMonth() - 1);
  const birAyOnceStr = toShortDateStr(birAyOnce);

  const durumIcon = (durum) => {
    switch ((durum || '').toLowerCase()) {
      case 'yapti': return 'âœ… YaptÄ±';
      case 'yapmadi': return 'âŒ YapmadÄ±';
      case 'eksik': return 'âš ï¸ Eksik';
      case 'getirmedi': return 'ğŸ“­ Getirmedi';
      default: return 'â– Bilgi Yok';
    }
  };

  // Firebase'ten Ã¶ÄŸrenci ve haftalÄ±k kayÄ±tlarÄ± al
  Promise.all([
    database.ref("ogrenciler").once("value"),
    database.ref("haftalikDegerlendirme").once("value")
  ]).then(([ogrenciSnap, haftalikSnap]) => {
    const ogrenciler = ogrenciSnap.val() || [];
    const haftalikKayitlar = haftalikSnap.val() || [];

    const ogrenci = Array.isArray(ogrenciler)
      ? ogrenciler.find(o => o.id == secilenId)
      : Object.values(ogrenciler).find(o => o.id == secilenId);

    if (!ogrenci) return;

    const ogrenciAdi = ogrenci.ad;

    const kayitlar = Array.isArray(haftalikKayitlar) ? haftalikKayitlar : Object.values(haftalikKayitlar);

    if (tip === 'haftalik') {
      const ogrenciKayitlari = kayitlar.filter(k => k.ogrenci === ogrenciAdi);
      const sonKayit = ogrenciKayitlari[ogrenciKayitlari.length - 1];

      const mesaj = `ğŸ“˜ Ã–zel Ders Takip Sistemi
ğŸ“… *Tarih:* ${formatTarih(bugun)}
ğŸ‘¤ *Ã–ÄŸrenci:* ${ogrenciAdi}
ğŸ“ *Ã–ÄŸretmen:* Ferhat KaragÃ¶z

ğŸ“Œ *Bu Hafta YapÄ±lanlar*
ğŸ“š *Ä°ÅŸlenen Konu:* ${sonKayit?.konu || 'Bilgi Yok'}
ğŸ“ *GeÃ§en Haftaki Ã–dev:* ${sonKayit?.odev || 'Ã–dev Yok'} â†’ ${durumIcon(sonKayit?.durum)}

ğŸ“– *Gelecek Hafta YapÄ±lacaklar*
ğŸ“ *Ã–dev:* ${sonKayit?.gelecekOdev || 'Ã–dev Yok'}
â° *Teslim Tarihi:* ${sonKayit?.tarih ? formatTarih(new Date(sonKayit.tarih)) : 'Tarih Yok'}
ğŸ“š *Ä°ÅŸlenecek Konular:* ${sonKayit?.gelecekKonu || 'Konu Yok'}

SaygÄ±larÄ±mÄ±zla, bilginize.`;

      document.getElementById('raporMesaj').value = mesaj;

    } else if (tip === 'aylik') {
      const tarihAraligindakiKayitlar = kayitlar
        .filter(k => {
          const ogr = k.ogrenci === ogrenciAdi;
          const tarihStr = toShortDateStr(k.zaman || k.tarih);
          return ogr && tarihStr >= birAyOnceStr && tarihStr <= bugunStr;
        })
        .sort((a, b) => new Date(b.zaman || b.tarih) - new Date(a.zaman || a.tarih));

      const konular = tarihAraligindakiKayitlar.map(k => {
        const t = new Date(k.zaman || k.tarih);
        return `- ${formatTarih(t)} â†’ ${k.konu || 'Konu girilmemiÅŸ'}`;
      });

      const odevSatirlari = tarihAraligindakiKayitlar.map(k => {
        const t = new Date(k.zaman || k.tarih);
        return `- ${formatTarih(t)} â†’ ${k.odev || 'Ã–dev Yok'} â†’ ${durumIcon(k.durum)}`;
      });

      const toplamOdev = tarihAraligindakiKayitlar.filter(k => k.odev).length;
      const yapilanOdev = tarihAraligindakiKayitlar.filter(k => (k.durum || '').toLowerCase() === 'yapti').length;
      const oran = toplamOdev ? Math.round((yapilanOdev / toplamOdev) * 100) : 0;

      const mesaj = `ğŸ“˜ Ã–zel Ders Takip Sistemi
ğŸ“… *Tarih:* ${formatTarih(bugun)}
ğŸ‘¤ *Ã–ÄŸrenci:* ${ogrenciAdi}
ğŸ“ *Ã–ÄŸretmen:* Ferhat KaragÃ¶z

ğŸ“… *Son 1 Ayda YapÄ±lanlar* (${formatTarih(birAyOnce)} - ${formatTarih(bugun)})

ğŸ“š *Ä°ÅŸlenen Konular:*
${konular.length ? konular.join("\n") : '- Veri yok'}

ğŸ“ *Verilen Ã–devler ve Kontrolleri:*
${odevSatirlari.length ? odevSatirlari.join("\n") : '- Veri yok'}

ğŸ“Š *Ã–dev PerformansÄ±*
- *Toplam Ã–dev:* ${toplamOdev}
- *Tamamlanan:* ${yapilanOdev}
- *BaÅŸarÄ± OranÄ±:* %${oran}

*Bu rapor, son bir ay iÃ§inde iÅŸlenen tÃ¼m konularÄ± ve Ã¶dev takibini iÃ§ermektedir.*

SaygÄ±larÄ±mÄ±zla, bilginize.`;

      document.getElementById('raporMesaj').value = mesaj;
    }
  });
}


function raporOgrenciSecDoldur() {
  const select = document.getElementById("raporOgrenciSec");
  if (!select) return;

  database.ref("ogrenciler").once("value")
    .then(snapshot => {
      const ogrenciler = snapshot.val() || [];
      select.innerHTML = '<option value="">Ã–ÄŸrenci SeÃ§iniz</option>';

      ogrenciler.forEach(o => {
        const option = document.createElement("option");
        option.value = o.id || o.ad; // GÃ¼venli
        option.textContent = o.ad;
        select.appendChild(option);
      });

      console.log("Dropdown iÃ§in Ã¶ÄŸrenciler yÃ¼klendi:", ogrenciler);
    })
    .catch(error => {
      console.error("Rapor Ã¶ÄŸrenci listesi alÄ±namadÄ±:", error);
    });
}


function raporOgrenciListesiDoldur() {
  const sec = document.getElementById('raporOgrenciSec');
  sec.innerHTML = '<option value="">-- SeÃ§iniz --</option>';
  const liste = JSON.parse(localStorage.getItem('ogrenciler') || '[]');
  liste.forEach(o => {
    const opt = document.createElement('option');
    opt.value = o.id;
    opt.textContent = o.ad + ' (' + o.sinif + ')';
    sec.appendChild(opt);
  });
}

window.addEventListener('load', () => {
  raporOgrenciSecDoldur();  // âœ… Bunu Ã§aÄŸÄ±r
  document.getElementById('raporTipi').addEventListener('change', raporMesajiOlustur);
  document.getElementById('raporOgrenciSec').addEventListener('change', raporMesajiOlustur);
  document.getElementById('raporAy').addEventListener('change', raporMesajiOlustur);
});
 let guncellenecekOdevKey = null;

function odevGuncelleModalAc(key) {
  database.ref("odevler/" + key).once("value")
    .then(snapshot => {
      const odev = snapshot.val();
      if (!odev) return;

      guncellenecekOdevKey = key;
      document.getElementById("guncelleOdevTarih").value = odev.tarih || "";
      document.getElementById("guncelleOdevIcerik").value = odev.konu || odev.icerik || "";

      document.getElementById("odevModalArkaPlan").style.display = "block";
      document.getElementById("odevGuncelleModal").style.display = "block";
    })
    .catch(error => {
      console.error("GÃ¼ncellenecek Ã¶dev alÄ±namadÄ±:", error);
    });
}



function odevModalKapat() {
  document.getElementById("odevModalArkaPlan").style.display = "none";
  document.getElementById("odevGuncelleModal").style.display = "none";
  guncellenecekOdevKey = null;
}

function odevGuncelle() {
  const yeniTarih = document.getElementById('guncelleOdevTarih').value;
  const yeniIcerik = document.getElementById('guncelleOdevIcerik').value.trim();

  if (!yeniTarih || !yeniIcerik) {
    alert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.');
    return;
  }

  if (!guncellenecekOdevKey) {
    alert("GÃ¼ncellenecek Ã¶dev bulunamadÄ±.");
    return;
  }

  database.ref("odevler/" + guncellenecekOdevKey).update({
    tarih: yeniTarih,
    konu: yeniIcerik
  })
  .then(() => {
    odevListele();
    odevModalKapat(); // modalÄ± kapat
  })
  .catch(error => {
    console.error("GÃ¼ncelleme sÄ±rasÄ±nda hata oluÅŸtu:", error);
    alert("Ã–dev gÃ¼ncellenemedi.");
  });
}

function odevGuncelleKaydet() {
  const yeniTarih = document.getElementById('guncelleOdevTarih').value;
  const yeniIcerik = document.getElementById('guncelleOdevIcerik').value.trim();

  if (!yeniTarih || !yeniIcerik) {
    alert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.');
    return;
  }

  if (!guncellenecekOdevKey) {
    alert("GÃ¼ncellenecek Ã¶dev bulunamadÄ±.");
    return;
  }

  database.ref("odevler/" + guncellenecekOdevKey).update({
    tarih: yeniTarih,
    konu: yeniIcerik
  })
  .then(() => {
    odevListele();             // Listeyi yeniden yÃ¼kle
    odevModalKapat();          // ModalÄ± kapat
    alert("âœ… Ã–dev gÃ¼ncellendi.");
  })
  .catch(error => {
    console.error("GÃ¼ncelleme sÄ±rasÄ±nda hata oluÅŸtu:", error);
    alert("âŒ Ã–dev gÃ¼ncellenemedi.");
  });
}

  
function getOdevler(callback) {
  database.ref("odevler").once("value")
    .then(snapshot => {
      const data = snapshot.val();
      const odevler = Array.isArray(data) ? data : Object.values(data || {});
      callback(odevler);
    })
    .catch(error => {
      console.error("Ã–dev verisi alÄ±namadÄ±:", error);
      callback([]);
    });
}


function setOdevler(data) {
  const newRef = database.ref("odevler").push();
  return newRef.set(data);
}




function setOdevler(data) {
  database.ref("odevler").set(data)
    .then(() => {
      console.log("Ã–devler baÅŸarÄ±yla kaydedildi.");
    })
    .catch(error => {
      console.error("Ã–devler kaydedilemedi:", error);
    });
}


function odevEkle() {
  const ogrenci = document.getElementById("odevOgrenci").value;
  const konu = document.getElementById("odevIcerik").value.trim();
  const tarih = document.getElementById("odevTarih").value;

  if (!ogrenci || !konu || !tarih) {
    alert("Ã–ÄŸrenci, konu ve tarih boÅŸ bÄ±rakÄ±lamaz.");
    return;
  }

  getOdevler(odevler => {
    const yeniOdev = { ogrenci, konu, tarih };
    odevler.push(yeniOdev);
    setOdevler(odevler);
    odevListele();
    alert("âœ… Ã–dev eklendi.");
  });
}




function odevSil(key) {
  if (confirm("Bu Ã¶devi silmek istediÄŸinize emin misiniz?")) {
    database.ref("odevler/" + key).remove()
      .then(() => {
        console.log("Ã–dev silindi:", key);
        odevListele();
      })
      .catch(error => {
        console.error("Ã–dev silinemedi:", error);
      });
  }
}



function tumOdevleriSil() {
  if (confirm("TÃ¼m Ã¶devleri silmek istediÄŸinize emin misiniz?")) {
    database.ref("odevler").remove()
      .then(() => {
        console.log("TÃ¼m Ã¶devler silindi.");
        odevListele();
      })
      .catch(error => {
        console.error("TÃ¼m Ã¶devler silinemedi:", error);
      });
  }
}



function odevFormTemizle() {
  document.getElementById('odevOgrenci').value = '';
  document.getElementById('odevTarih').value = '';
  document.getElementById('odevIcerik').value = '';
}

function odevListele() {
  const liste = document.getElementById("odevListesi");
  if (!liste) return;

  liste.innerHTML = ""; // Ã–nceki listeyi temizle

  database.ref("odevler").once("value")
    .then(snapshot => {
      const odevler = snapshot.val() || {};

      Object.entries(odevler).forEach(([key, odev]) => {
        const div = document.createElement("div");
        div.className = "student-entry";

        const span = document.createElement("span");
        span.textContent = `${odev.ogrenci || 'Ã–ÄŸrenci Yok'} - ${odev.tarih || 'Tarih Yok'} - ${odev.konu || odev.icerik || 'Ä°Ã§erik Yok'}`;

        const silBtn = document.createElement("button");
        silBtn.textContent = "ğŸ—‘ï¸";
        silBtn.className = "btn-small";
        silBtn.onclick = () => odevSil(key);

        const guncelleBtn = document.createElement("button");
        guncelleBtn.textContent = "âœï¸";
        guncelleBtn.className = "btn-small";
        guncelleBtn.onclick = () => odevGuncelleModalAc(key);

        div.appendChild(span);
        div.appendChild(silBtn);
        div.appendChild(guncelleBtn);
        liste.appendChild(div);
      });
    })
    .catch(error => {
      console.error("Ã–devler listelenemedi:", error);
    });
}






function doldurOgrenciSecimi() {
  const select = document.getElementById('odevOgrenci');
  if (!select) return;

  select.innerHTML = '<option value="">Ã–ÄŸrenci SeÃ§iniz</option>';

  getOgrenciler(ogrenciler => {
    ogrenciler.forEach(o => {
      const opt = document.createElement("option");
      opt.value = o.ad;
opt.textContent = o.ad;
      select.appendChild(opt);
    });
  });
}




window.addEventListener('load', () => {
  doldurOgrenciSecimi();
  odevListele();
});
  
function haftalikVeriyiEkle() {
  const ogrenci = document.getElementById('haftaOgrenci').value;
  const odev = document.getElementById('haftaOdev').value;
  const durum = document.getElementById('odevDurumu').value;
  const konu = document.getElementById('buHaftaKonu').value.trim();
  const gelecekOdev = document.getElementById('gelecekHaftaOdev').value.trim();
  const tarih = document.getElementById('gelecekTarih').value;
  const gelecekKonu = document.getElementById('gelecekHaftaKonu').value.trim();

  if (!ogrenci || !tarih) {
    alert("ğŸš« Ã–ÄŸrenci ve tarih boÅŸ bÄ±rakÄ±lamaz.");
    return;
  }

  const zamanDamgasi = new Date().toISOString();

  const haftalikKayit = {
    ogrenci,
    odev,
    durum,
    konu,
    gelecekOdev,
    tarih,
    gelecekKonu,
    zaman: zamanDamgasi
  };

  const odevKaydi = {
    ogrenci,
    konu: gelecekOdev,
    tarih
  };

  // Firebase'e hem haftalÄ±k kayÄ±t hem de odev kaydÄ± ekleniyor
  const haftalikRef = database.ref("haftalikDegerlendirme").push();
  const odevRef = database.ref("odevler").push();

  Promise.all([
    haftalikRef.set(haftalikKayit),
    odevRef.set(odevKaydi)
  ])
    .then(() => {
      document.getElementById('haftaDurumMesaji').innerText = 'âœ… KayÄ±t ve Ã¶dev baÅŸarÄ±yla eklendi.';
      haftalikKayitlariListele();
      odevListele(); // opsiyonel: Ã–dev ekranÄ± da yenilensin
    })
    .catch(error => {
      console.error("âŒ KayÄ±t eklenemedi:", error);
      alert("âš ï¸ Veri eklenirken hata oluÅŸtu.");
    });
}





function haftalikVeriyiKaydet() {
  const ogrenci = document.getElementById('haftaOgrenci').value;
  const odev = document.getElementById('haftaOdev').value;
  const durum = document.getElementById('odevDurumu').value;
  const konu = document.getElementById('buHaftaKonu').value.trim();
  const gelecekOdev = document.getElementById('gelecekHaftaOdev').value.trim();
  const tarih = document.getElementById('gelecekTarih').value;
  const gelecekKonu = document.getElementById('gelecekHaftaKonu').value.trim();

  if (!ogrenci || !tarih) {
    alert("ğŸš« Ã–ÄŸrenci ve tarih zorunludur.");
    return;
  }

  const zamanDamgasi = new Date().toISOString();

  const haftalikKayit = {
    ogrenci,
    odev,
    durum,
    konu,
    gelecekOdev,
    tarih,
    gelecekKonu,
    zaman: zamanDamgasi
  };

  database.ref("haftalikDegerlendirme").push(haftalikKayit)
    .then(() => {
      document.getElementById('haftaDurumMesaji').innerText = 'âœ… TÃ¼m veri kaydedildi.';
      haftalikFormYenile();
      haftalikKayitlariListele();  // Listeyi yenile
    })
    .catch(error => {
      console.error("âŒ HaftalÄ±k veri kaydÄ± baÅŸarÄ±sÄ±z:", error);
      alert("âš ï¸ KayÄ±t eklenirken hata oluÅŸtu.");
    });
}



function haftalikFormYenile() {
  document.getElementById('haftaOgrenci').value = '';
  document.getElementById('haftaOdev').value = '';
  document.getElementById('odevDurumu').value = '';
  document.getElementById('buHaftaKonu').value = '';
  document.getElementById('gelecekHaftaOdev').value = '';
  document.getElementById('gelecekTarih').value = '';
  document.getElementById('gelecekHaftaKonu').value = '';
  document.getElementById('haftaDurumMesaji').innerText = '';
}

function doldurHaftaOgrenciListesi() {
  const select = document.getElementById('haftaOgrenci');
  if (!select) return;

  select.innerHTML = '<option value="">Ã–ÄŸrenci SeÃ§in</option>';

  database.ref("ogrenciler").once("value")
    .then(snapshot => {
      const data = snapshot.val();
      if (!data) return;

      Object.values(data).forEach(o => {
        const option = document.createElement("option");
        option.value = o.ad;
        option.textContent = o.ad;
        select.appendChild(option);
      });
    })
    .catch(error => {
      console.error("Hafta Ã¶ÄŸrenci listesi yÃ¼klenemedi:", error);
    });
}



document.getElementById('haftaOgrenci').addEventListener('change', function () {
  const seciliOgrenci = this.value;
  const select = document.getElementById('haftaOdev');
  select.innerHTML = '<option value="">Ã–dev SeÃ§in</option>';

  database.ref("odevler").once("value")
    .then(snapshot => {
      const odevler = snapshot.val() || {};
      Object.values(odevler)
        .filter(o => o.ogrenci === seciliOgrenci)
        .forEach(o => {
          const option = document.createElement("option");
          option.value = o.konu || o.icerik || '';
          option.textContent = `${o.tarih} - ${o.konu || o.icerik}`;
          select.appendChild(option);
        });
    })
    .catch(error => {
      console.error("Ã–devler yÃ¼klenemedi:", error);
    });
});


window.addEventListener('load', doldurHaftaOgrenciListesi);
    let guncellenecekId = null;

    function switchTab(id, el) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tabBtn').forEach(btn => btn.classList.remove('active'));
  el.classList.add('active');
}

function temizleInputlar() {
  document.getElementById('ogrenciAd').value = '';
  document.getElementById('ogrenciSinif').value = '';
}


function getOgrenciler(callback) {
  database.ref("ogrenciler").once("value")
    .then(snapshot => {
      const data = snapshot.val();
      callback(data ? data : []);
    })
    .catch(error => {
      console.error("Ã–ÄŸrenciler alÄ±nÄ±rken hata oluÅŸtu:", error);
      callback([]); // Hata durumunda boÅŸ liste dÃ¶ner
    });
}


    function setOgrenciler(data) {
  database.ref("ogrenciler").set(data)
    .then(() => {
      console.log("Ã–ÄŸrenciler baÅŸarÄ±yla kaydedildi.");
    })
    .catch(error => {
      console.error("Ã–ÄŸrenciler kaydedilirken hata oluÅŸtu:", error);
    });
}


function ogrenciEkle() {
  const ad = document.getElementById("ogrenciAd").value.trim();
  const sinif = document.getElementById("ogrenciSinif").value;
  const id = Date.now();

  if (!ad || !sinif) {
    alert("LÃ¼tfen Ã¶ÄŸrenci adÄ± ve sÄ±nÄ±f seÃ§in.");
    return;
  }

  // Ã–nce mevcut Ã¶ÄŸrencileri al
  database.ref("ogrenciler").once("value")
    .then(snapshot => {
      const ogrenciler = snapshot.val() || [];
      const yeniOgrenci = { id, ad, sinif };
      ogrenciler.push(yeniOgrenci);
      return database.ref("ogrenciler").set(ogrenciler);
    })
    .then(() => {
      alert("âœ… Ã–ÄŸrenci eklendi.");
      ogrenciListele(); // Listeyi gÃ¼ncelle
      temizleInputlar(); // Formu temizle
    })
    .catch(error => {
      console.error("Ã–ÄŸrenci eklenemedi:", error);
      alert("Hata: Ã–ÄŸrenci eklenemedi.");
    });
}



function ogrenciSil(id) {
  getOgrenciler(ogrenciler => {
    const guncelOgrenciler = ogrenciler.filter(o => o.id !== id);
    setOgrenciler(guncelOgrenciler);
    ogrenciListele(); // Listeyi gÃ¼ncelle
  });
}


    function ogrenciGuncelle(id) {
      const ogrenciler = getOgrenciler();
      const ogrenci = ogrenciler.find(o => o.id === id);
      if (ogrenci) {
        guncellenecekId = id;
        document.getElementById('guncelleAd').value = ogrenci.ad;
        document.getElementById('guncelleSinif').value = ogrenci.sinif;
        document.getElementById('modalArkaPlan').style.display = 'block';
        document.getElementById('guncelleModal').style.display = 'block';
      }
    }

    function modalKapat() {
      document.getElementById('modalArkaPlan').style.display = 'none';
      document.getElementById('guncelleModal').style.display = 'none';
    }

function ogrenciGuncelleKaydet() {
  const id = parseInt(document.getElementById("guncelle-id").value);
  const isim = document.getElementById("guncelle-isim").value.trim();
  const soyisim = document.getElementById("guncelle-soyisim").value.trim();
  const sinif = document.getElementById("guncelle-sinif").value;

  getOgrenciler(ogrenciler => {
    const guncelOgrenciler = ogrenciler.map(o => {
      if (o.id === id) {
        return { id, isim, soyisim, sinif };
      }
      return o;
    });

    setOgrenciler(guncelOgrenciler);
    ogrenciListele();
  });

  // GÃ¼ncelleme panelini kapat
  document.getElementById("guncelle-form").style.display = "none";
}


function ogrenciListele() {
  const liste = document.getElementById("ogrenciListesi");
  if (!liste) return;

  database.ref("ogrenciler").once("value")
    .then(snapshot => {
      const ogrenciler = snapshot.val() || [];
      liste.innerHTML = "";
      ogrenciler.forEach(ogrenci => {
        const div = document.createElement("div");
        div.classList.add("student-entry");
        div.innerHTML = `
          <span>${ogrenci.ad} (${ogrenci.sinif})</span>
          <button class="btn-small" onclick="ogrenciSil(${ogrenci.id})">ğŸ—‘ï¸</button>
        `;
        liste.appendChild(div);
      });
    })
    .catch(error => {
      console.error("Ã–ÄŸrenciler listelenemedi:", error);
    });
}


  window.onload = ogrenciListele;
  window.addEventListener('load', () => {
  haftalikKayitlariListele();
});
  </script>
</body>
</html>
