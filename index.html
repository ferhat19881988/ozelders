<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Özel Ders Takip Sistemi</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      color: #333;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tabs button {
  font-size: 13px;
  line-height: 1.2;
  white-space: normal; /* metin sarılabilir */
  width: 100px;
}
    .tabs button.active {
      border-color: #333;
      background: #ddd;
    }
    section {
      display: none;
      background: white;
      border-radius: 10px;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    section.active {
      display: block;
    }
    input, select, textarea, button {
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #ddd;
    }
    .btn-small {
      width: auto;
      margin: 0 5px;
      padding: 6px 12px;
    }
    .icon {
      font-size: 16px;
      margin-right: 5px;
    }
    .student-entry {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    .student-entry span {
      flex: 1;
      text-align: left;
    }
    #guncelleModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      display: none;
      z-index: 1000;
      width: 90%;
      max-width: 400px;
    }
    #modalArkaPlan {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      display: none;
      z-index: 999;
    }
    #haftalikKayitListesi,
#odevListesi {
  max-height: 300px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  background: #fafafa;
}
#qrCanvasContainer {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 10px auto;
  width: 100%;
}

  </style>
</head>
<body>
  <h1>📘 Özel Ders Takip Sistemi</h1>  <div class="tabs">
 <button class="tabBtn" onclick="switchTab('ogrenciKayit', this)">👤 Öğrenci Kaydı</button>
<button class="tabBtn" onclick="switchTab('haftalikDegerlendirme', this)">📅 Haftalık Değerlendirme</button>
<button class="tabBtn" onclick="switchTab('whatsappRapor', this)">📤 WhatsApp Rapor</button>
<button class="tabBtn" onclick="switchTab('veriYonetimi', this)">💾 Veri Yedekleme</button>
  </div>  <section id="ogrenciKayit" class="active">
    <h2>👤 Öğrenci Kaydı</h2>
    <input type="text" id="ogrenciAd" placeholder="Öğrenci Adı">
    <select id="ogrenciSinif">
      <option value="">Sınıf Seçiniz</option>
      <option value="5. Sınıf">5. Sınıf</option>
      <option value="6. Sınıf">6. Sınıf</option>
      <option value="7. Sınıf">7. Sınıf</option>
      <option value="8. Sınıf">8. Sınıf</option>
    </select>
    <div style="display: flex; gap: 10px;">
      <button onclick="ogrenciEkle()">➕ Öğrenci Ekle</button>
      <button onclick="temizleInputlar()">🔄 Yenile</button>
    </div>
    <div id="ogrenciListesi"></div>
    <hr>
<h3>📘 Ödev Ekle</h3>

<select id="odevOgrenci">
  <option value="">Öğrenci Seçiniz</option>
</select>

<input type="date" id="odevTarih">
<textarea id="odevIcerik" placeholder="Ödev içeriği girin..."></textarea>

<div style="display: flex; gap: 10px;">
  <button onclick="odevEkle()">➕ Ödev Ekle</button>
  <button onclick="odevFormTemizle()">🔄 Yenile</button>
  <button onclick="tumOdevleriSil()">🗑️ Tüm Ödevleri Sil</button>
</div>

<div id="odevListesi"></div>
  </section>  <section id="veriYonetimi">
    <h2>💾 Verileri Yedekle & Geri Yükle</h2>
    <input type="text" id="dosyaAdi" placeholder="Dosya adı girin (örn: yedek-temmuz)">
    <div>
      <button onclick="verileriYedekle()">⬇️ Verileri Dışa Aktar</button>
      <input type="file" id="yedekDosya" style="display:none" onchange="verileriYukle(event)">
      <button onclick="document.getElementById('yedekDosya').click()">⬆️ Yedeği Geri Yükle</button>
    </div>
    <p id="yedekDurum"></p>
  </section>  <div id="modalArkaPlan" onclick="modalKapat()"></div>
  <div id="guncelleModal">
    <h3>✏️ Öğrenci Güncelle</h3>
    <input type="text" id="guncelleAd">
    <select id="guncelleSinif">
      <option value="">Sınıf Seçiniz</option>
      <option value="5. Sınıf">5. Sınıf</option>
      <option value="6. Sınıf">6. Sınıf</option>
      <option value="7. Sınıf">7. Sınıf</option>
      <option value="8. Sınıf">8. Sınıf</option>
    </select>
    <button onclick="ogrenciGuncelleKaydet()">💾 Kaydet</button>
    <button onclick="modalKapat()">❌ Kapat</button>
  </div>  
  <section id="haftalikDegerlendirme">
  <h2>📅 Haftalık Değerlendirme</h2>

  <select id="haftaOgrenci">
    <option value="">Öğrenci Seçin</option>
  </select>

  <select id="haftaOdev">
    <option value="">Ödev Seçin</option>
  </select>

  <select id="odevDurumu">
    <option value="">Ödev Durumu</option>
    <option value="yapti">✅ Yaptı</option>
    <option value="yapmadi">❌ Yapmadı</option>
    <option value="eksik">⚠️ Eksik</option>
    <option value="getirmedi">📭 Getirmedi</option>
  </select>

  <textarea id="buHaftaKonu" placeholder="Bu hafta işlenen konu"></textarea>
  <textarea id="gelecekHaftaOdev" placeholder="Gelecek haftanın ödevi"></textarea>
  <input type="date" id="gelecekTarih">
  <textarea id="gelecekHaftaKonu" placeholder="Gelecek hafta işlenecek konu"></textarea>

  <button onclick="haftalikVeriyiEkle()">➕ Ödevi Sisteme Ekle</button>
  <button onclick="haftalikVeriyiKaydet()">💾 Tümünü Kaydet</button>
  <button onclick="haftalikFormYenile()">🔄 Yenile</button>
<hr>
<h3>📋 Kayıtlı Haftalık Değerlendirmeler</h3>
<div id="haftalikKayitListesi"></div>
  <p id="haftaDurumMesaji"></p>
</section>
  <div id="odevModalArkaPlan" onclick="odevModalKapat()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999;"></div>

<div id="odevGuncelleModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; padding:20px; border-radius:10px; max-width:400px; width:90%; z-index:1000;">
  <h3>✏️ Ödev Güncelle</h3>
  <input type="date" id="guncelleOdevTarih">
  <textarea id="guncelleOdevIcerik" rows="4"></textarea>
  <button onclick="odevGuncelleKaydet()">💾 Kaydet</button>
  <button onclick="odevModalKapat()">❌ Kapat</button>
</div>
  <!-- WhatsApp Rapor Sekmesi Başlangıcı -->
  <section id="whatsappRapor">
  <h2>📤 WhatsApp Raporları</h2>  <div style="margin-bottom: 20px;">
    <label for="raporTipi"><strong>Rapor Türü:</strong></label>
    <select id="raporTipi" onchange="raporTipiDegisti()">
      <option value="haftalik">📅 Haftalık Rapor</option>
      <option value="aylik">📆 Aylık Rapor</option>
    </select>
  </div>  <!-- Ortak Öğrenci Seçimi -->  <div style="margin-bottom: 15px;">
    <label for="raporOgrenciSec">👤 Öğrenci Seç:</label>
    <select id="raporOgrenciSec"></select>
  </div> 
    <!-- Mesaj Önizleme Alanı -->  <div>
    <label><strong>📄 Oluşturulan Mesaj:</strong></label>
    <textarea id="raporMesaj" rows="12"></textarea></div>  <!-- Gönder Butonu -->
    <button onclick="whatsappMesajGonder()">📤 Gönder</button>
    <button onclick="raporFormYenile()">🔄 Yenile</button>
    <button onclick="qrKodModalAc()">📱 QR Kod ile Göster</button>
<div id="qrCanvasContainer"></div>
</section>
<!-- WhatsApp Rapor Sekmesi Sonu -->
  <!-- Haftalık Kayıt Güncelle Modalı -->
<div id="haftalikModalArkaPlan" onclick="haftalikModalKapat()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999;"></div>

<div id="haftalikGuncelleModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; padding:20px; border-radius:10px; max-width:450px; width:90%; z-index:1000;">
  <h3>✏️ Haftalık Kayıt Güncelle</h3>
  <input type="text" id="guncelleHaftaOgrenci" placeholder="Öğrenci Adı">
  <input type="text" id="guncelleHaftaKonu" placeholder="Bu hafta konusu">
  <input type="text" id="guncelleHaftaOdev" placeholder="Ödev">
  <input type="text" id="guncelleHaftaDurum" placeholder="Ödev durumu (yapti, yapmadi...)">
  <input type="date" id="guncelleHaftaTarih">
  <input type="text" id="guncelleGelecekKonu" placeholder="Gelecek hafta konusu">
  <input type="text" id="guncelleGelecekOdev" placeholder="Gelecek hafta ödevi">
  <button onclick="haftalikKaydiGuncelleKaydet()">💾 Kaydet</button>
  <button onclick="haftalikModalKapat()">❌ Kapat</button>
</div>

  <script>
function qrKodModalAc() {
  const mesaj = document.getElementById('raporMesaj').value.trim();
  if (!mesaj) return alert("Mesaj boş.");
  const url = `https://wa.me/?text=${encodeURIComponent(mesaj)}`;

  const container = document.getElementById('qrCanvasContainer');
  container.innerHTML = '';
  new QRCode(container, {
    text: url,
    width: 250,
    height: 250,
    correctLevel: QRCode.CorrectLevel.M
  });

  document.getElementById('qrModalArkaPlan').style.display = 'block';
  document.getElementById('qrModal').style.display = 'block';
}

    
   function raporFormYenile() {
  document.getElementById('raporTipi').value = 'haftalik';
  document.getElementById('raporOgrenciSec').value = '';
  document.getElementById('raporMesaj').value = '';
}

   
  let guncellenecekHaftaIndex = null;

function haftalikKaydiGuncelle(index) {
  const kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  const k = kayitlar[index];
  guncellenecekHaftaIndex = index;
  document.getElementById('guncelleHaftaOgrenci').value = k.ogrenci || '';
  document.getElementById('guncelleHaftaKonu').value = k.konu || '';
  document.getElementById('guncelleHaftaOdev').value = k.odev || '';
  document.getElementById('guncelleHaftaDurum').value = k.durum || '';
  document.getElementById('guncelleHaftaTarih').value = k.tarih || '';
  document.getElementById('guncelleGelecekKonu').value = k.gelecekKonu || '';
  document.getElementById('guncelleGelecekOdev').value = k.gelecekOdev || '';
  document.getElementById('haftalikModalArkaPlan').style.display = 'block';
  document.getElementById('haftalikGuncelleModal').style.display = 'block';
}

function haftalikKaydiGuncelleKaydet() {
  const kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  if (guncellenecekHaftaIndex === null) return;

  kayitlar[guncellenecekHaftaIndex] = {
    ogrenci: document.getElementById('guncelleHaftaOgrenci').value,
    konu: document.getElementById('guncelleHaftaKonu').value,
    odev: document.getElementById('guncelleHaftaOdev').value,
    durum: document.getElementById('guncelleHaftaDurum').value,
    tarih: document.getElementById('guncelleHaftaTarih').value,
    gelecekKonu: document.getElementById('guncelleGelecekKonu').value,
    gelecekOdev: document.getElementById('guncelleGelecekOdev').value,
    zaman: new Date().toISOString()
  };

  localStorage.setItem('haftalikKayitlar', JSON.stringify(kayitlar));
  haftalikModalKapat();
  haftalikKayitlariListele();
}

function haftalikModalKapat() {
  document.getElementById('haftalikModalArkaPlan').style.display = 'none';
  document.getElementById('haftalikGuncelleModal').style.display = 'none';
  guncellenecekHaftaIndex = null;
}
  
  function haftalikKaydiSil(index) {
  if (!confirm("Bu haftalık kayıt silinsin mi?")) return;
  let kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  kayitlar.splice(index, 1);
  localStorage.setItem('haftalikKayitlar', JSON.stringify(kayitlar));
  haftalikKayitlariListele();
}
  
function haftalikKayitlariListele() {
  const liste = document.getElementById('haftalikKayitListesi');
  const kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');

  if (kayitlar.length === 0) {
    liste.innerHTML = '<p>Henüz haftalık değerlendirme yapılmamış.</p>';
    return;
  }

  // Sıralama: Yeni en üstte
  kayitlar.sort((a, b) => new Date(b.zaman || b.tarih) - new Date(a.zaman || a.tarih));

  liste.innerHTML = kayitlar.map((k, i) => `
    <div class="student-entry">
      <span>
        👤 <b>${k.ogrenci}</b><br>
        📌 Konu: ${k.konu || '-'}<br>
        📅 Tarih: ${k.tarih || '-'}<br>
        📘 Ödev: ${k.odev || '-'} (${k.durum || 'Durum yok'})<br>
        ➡️ Gelecek Hafta: ${k.gelecekKonu || '-'} / ${k.gelecekOdev || '-'}
      </span>
      <div>
        <button class="btn-small" onclick="haftalikKaydiSil(${i})">🗑️</button>
        <button class="btn-small" onclick="haftalikKaydiGuncelle(${i})">✏️</button>
      </div>
    </div>
  `).join('');
}

  
  function raporTipiDegisti() {
  const raporTipi = document.getElementById('raporTipi').value;
  const aylikSecimAlani = document.getElementById('aylikSecimAlani');
  aylikSecimAlani.style.display = (raporTipi === 'aylik') ? 'block' : 'none';
  raporMesajiOlustur();
}

function whatsappMesajGonder() {
  const mesaj = document.getElementById('raporMesaj').value.trim();
  if (!mesaj) return alert('Gönderilecek mesaj boş.');
  const url = `https://wa.me/?text=${encodeURIComponent(mesaj)}`;
  window.open(url, '_blank');
}

function raporMesajiOlustur() {
  const tip = document.getElementById('raporTipi').value;
  const secilenId = document.getElementById('raporOgrenciSec').value;
  const ogrenciler = JSON.parse(localStorage.getItem('ogrenciler') || '[]');
  const haftalikKayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  const ogrenci = ogrenciler.find(o => o.id === secilenId);
  if (!ogrenci) return;

  const ayAdlari = ['Ocak','Şubat','Mart','Nisan','Mayıs','Haziran','Temmuz','Ağustos','Eylül','Ekim','Kasım','Aralık'];
  const formatTarih = (date) => `${date.getDate()} ${ayAdlari[date.getMonth()]} ${date.getFullYear()}`;
  const toShortDateStr = (d) => new Date(d).toISOString().split('T')[0];

  const bugun = new Date();
  const bugunStr = toShortDateStr(bugun);
  const birAyOnce = new Date(bugun);
  birAyOnce.setMonth(birAyOnce.getMonth() - 1);
  const birAyOnceStr = toShortDateStr(birAyOnce);

  const durumIcon = (durum) => {
    switch ((durum || '').toLowerCase()) {
      case 'yapti': return '✅ Yaptı';
      case 'yapmadi': return '❌ Yapmadı';
      case 'eksik': return '⚠️ Eksik';
      case 'getirmedi': return '📭 Getirmedi';
      default: return '➖ Bilgi Yok';
    }
  };

  const ogrenciAdi = ogrenci.ad;

  if (tip === 'haftalik') {
    const kayitlar = haftalikKayitlar.filter(k => k.ogrenci === ogrenciAdi);
    const sonKayit = kayitlar[kayitlar.length - 1];

    const mesaj = `📘 Özel Ders Takip Sistemi
📅 *Tarih:* ${formatTarih(bugun)}
👤 *Öğrenci:* ${ogrenciAdi}
🎓 *Öğretmen:* Ferhat Karagöz

📌 *Bu Hafta Yapılanlar*
📚 *İşlenen Konu:* ${sonKayit?.konu || 'Bilgi Yok'}
📝 *Geçen Haftaki Ödev:* ${sonKayit?.odev || 'Ödev Yok'} → ${durumIcon(sonKayit?.durum)}

📖 *Gelecek Hafta Yapılacaklar*
📝 *Ödev:* ${sonKayit?.gelecekOdev || 'Ödev Yok'}
⏰ *Teslim Tarihi:* ${sonKayit?.tarih ? formatTarih(new Date(sonKayit.tarih)) : 'Tarih Yok'}
📚 *İşlenecek Konular:* ${sonKayit?.gelecekKonu || 'Konu Yok'}

Saygılarımızla, bilginize.`;

    document.getElementById('raporMesaj').value = mesaj;

  } else if (tip === 'aylik') {
    // Sıralanmış şekilde alınan son 1 aylık kayıtlar (yeni → eski)
    const tarihAraligindakiKayitlar = haftalikKayitlar
      .filter(k => {
        const ogr = k.ogrenci === ogrenciAdi;
        const tarihStr = toShortDateStr(k.zaman || k.tarih);
        return ogr && tarihStr >= birAyOnceStr && tarihStr <= bugunStr;
      })
      .sort((a, b) => {
        const tA = new Date(a.zaman || a.tarih);
        const tB = new Date(b.zaman || b.tarih);
        return tB - tA; // Yeni tarih başta
      });

    const konular = tarihAraligindakiKayitlar.map(k => {
      const t = new Date(k.zaman || k.tarih);
      return `- ${formatTarih(t)} → ${k.konu || 'Konu girilmemiş'}`;
    });

    const odevSatirlari = tarihAraligindakiKayitlar.map(k => {
      const t = new Date(k.zaman || k.tarih);
      return `- ${formatTarih(t)} → ${k.odev || 'Ödev Yok'} → ${durumIcon(k.durum)}`;
    });

    const toplamOdev = tarihAraligindakiKayitlar.filter(k => k.odev).length;
    const yapilanOdev = tarihAraligindakiKayitlar.filter(k => (k.durum || '').toLowerCase() === 'yapti').length;
    const oran = toplamOdev ? Math.round((yapilanOdev / toplamOdev) * 100) : 0;

    const mesaj = `📘 Özel Ders Takip Sistemi
📅 *Tarih:* ${formatTarih(bugun)}
👤 *Öğrenci:* ${ogrenciAdi}
🎓 *Öğretmen:* Ferhat Karagöz

📅 *Son 1 Ayda Yapılanlar* (${formatTarih(birAyOnce)} - ${formatTarih(bugun)})

📚 *İşlenen Konular:*
${konular.length ? konular.join("\n") : '- Veri yok'}

📝 *Verilen Ödevler ve Kontrolleri:*
${odevSatirlari.length ? odevSatirlari.join("\n") : '- Veri yok'}

📊 *Ödev Performansı*
- *Toplam Ödev:* ${toplamOdev}
- *Tamamlanan:* ${yapilanOdev}
- *Başarı Oranı:* %${oran}

*Bu rapor, son bir ay içinde işlenen tüm konuları ve ödev takibini içermektedir.*

Saygılarımızla, bilginize.`;

    document.getElementById('raporMesaj').value = mesaj;
  }
}



function raporOgrenciListesiDoldur() {
  const sec = document.getElementById('raporOgrenciSec');
  sec.innerHTML = '<option value="">-- Seçiniz --</option>';
  const liste = JSON.parse(localStorage.getItem('ogrenciler') || '[]');
  liste.forEach(o => {
    const opt = document.createElement('option');
    opt.value = o.id;
    opt.textContent = o.ad + ' (' + o.sinif + ')';
    sec.appendChild(opt);
  });
}

window.addEventListener('load', () => {
  raporOgrenciListesiDoldur();
  document.getElementById('raporTipi').addEventListener('change', raporMesajiOlustur);
  document.getElementById('raporOgrenciSec').addEventListener('change', raporMesajiOlustur);
  document.getElementById('raporAy').addEventListener('change', raporMesajiOlustur);
});
  let guncellenecekOdevIndex = null;

function odevGuncelleModalAc(index) {
  const odevler = getOdevler();
  const o = odevler[index];
  guncellenecekOdevIndex = index;
  document.getElementById('guncelleOdevTarih').value = o.tarih;
  document.getElementById('guncelleOdevIcerik').value = o.icerik;
  document.getElementById('odevModalArkaPlan').style.display = 'block';
  document.getElementById('odevGuncelleModal').style.display = 'block';
}

function odevModalKapat() {
  document.getElementById('odevModalArkaPlan').style.display = 'none';
  document.getElementById('odevGuncelleModal').style.display = 'none';
}

function odevGuncelleKaydet() {
  const yeniTarih = document.getElementById('guncelleOdevTarih').value;
  const yeniIcerik = document.getElementById('guncelleOdevIcerik').value.trim();
  if (!yeniTarih || !yeniIcerik) {
    alert('Lütfen tüm alanları doldurun.');
    return;
  }

  const odevler = getOdevler();
  if (guncellenecekOdevIndex !== null) {
    odevler[guncellenecekOdevIndex].tarih = yeniTarih;
    odevler[guncellenecekOdevIndex].icerik = yeniIcerik;
    setOdevler(odevler);
    odevListele();
    odevModalKapat();
  }
}
  
  function getOdevler() {
  return JSON.parse(localStorage.getItem('odevler') || '[]');
}

function setOdevler(data) {
  localStorage.setItem('odevler', JSON.stringify(data));
}

function odevEkle() {
  const ogrenci = document.getElementById('odevOgrenci').value;
  const tarih = document.getElementById('odevTarih').value;
  const icerik = document.getElementById('odevIcerik').value.trim();

  if (!ogrenci || !tarih || !icerik) {
    alert('Lütfen tüm alanları doldurun.');
    return;
  }

  const odevler = getOdevler();
  odevler.push({ ogrenci, tarih, icerik });
  setOdevler(odevler);
  odevFormTemizle();
  odevListele();
}

function odevSil(index) {
  if (!confirm('Bu ödev silinsin mi?')) return;
  const odevler = getOdevler();
  odevler.splice(index, 1);
  setOdevler(odevler);
  odevListele();
}

function tumOdevleriSil() {
  if (!confirm('Tüm ödevler silinsin mi?')) return;
  localStorage.removeItem('odevler');
  odevListele();
}

function odevFormTemizle() {
  document.getElementById('odevOgrenci').value = '';
  document.getElementById('odevTarih').value = '';
  document.getElementById('odevIcerik').value = '';
}

function odevListele() {
  const liste = document.getElementById('odevListesi');
  const odevler = getOdevler();

  if (odevler.length === 0) {
    liste.innerHTML = '<p>Henüz ödev girilmedi.</p>';
    return;
  }

  // Sıralama: Yeni en üstte
  odevler.sort((a, b) => new Date(b.tarih) - new Date(a.tarih));

  liste.innerHTML = odevler.map((o, i) => `
    <div class="student-entry">
      <span><b>${o.ogrenci}</b> - ${o.tarih} <br> ${o.icerik}</span>
      <div>
        <button class="btn-small" onclick="odevSil(${i})">🗑️</button>
        <button class="btn-small" onclick="odevGuncelleModalAc(${i})">✏️</button>
      </div>
    </div>
  `).join('');
}


function doldurOgrenciSecimi() {
  const ogrenciler = JSON.parse(localStorage.getItem('ogrenciler') || '[]');
  const select = document.getElementById('odevOgrenci');
  if (!select) return;
  select.innerHTML = '<option value=\"\">Öğrenci Seçiniz</option>' +
    ogrenciler.map(o => `<option value=\"${o.ad}\">${o.ad}</option>`).join('');
}

window.addEventListener('load', () => {
  doldurOgrenciSecimi();
  odevListele();
});
  
  function haftalikVeriyiEkle() {
  const ogrenci = document.getElementById('haftaOgrenci').value;
  const odevIcerik = document.getElementById('gelecekHaftaOdev').value.trim();
  const tarih = document.getElementById('gelecekTarih').value;

  if (!ogrenci || !odevIcerik || !tarih) {
    alert('Öğrenci, ödev ve tarih girilmelidir.');
    return;
  }

  // Ödevi haftalık sisteme ekleme (ayrıca localStorage'da saklanan haftalık kayıtlara dahil edilebilir)
  const odevler = JSON.parse(localStorage.getItem('odevler') || '[]');
  odevler.push({ ogrenci, tarih, icerik: odevIcerik });
  localStorage.setItem('odevler', JSON.stringify(odevler));

  // Liste güncellensin (eğer varsa)
  if (typeof odevListele === 'function') {
    odevListele();
  }

  document.getElementById('haftaDurumMesaji').innerText = '✅ Ödev sisteme kaydedildi.';
}

function haftalikVeriyiKaydet() {
  const data = {
    ogrenci: document.getElementById('haftaOgrenci').value,
    odev: document.getElementById('haftaOdev').value,
    durum: document.getElementById('odevDurumu').value,
    konu: document.getElementById('buHaftaKonu').value.trim(),
    gelecekOdev: document.getElementById('gelecekHaftaOdev').value.trim(),
    tarih: document.getElementById('gelecekTarih').value,
    gelecekKonu: document.getElementById('gelecekHaftaKonu').value.trim(),
    zaman: new Date().toISOString()
  };
  const kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  kayitlar.push(data);
  localStorage.setItem('haftalikKayitlar', JSON.stringify(kayitlar));
  document.getElementById('haftaDurumMesaji').innerText = '💾 Kayıt başarıyla yapıldı';
  haftalikKayitlariListele();
}

function haftalikFormYenile() {
  document.getElementById('haftaOgrenci').value = '';
  document.getElementById('haftaOdev').value = '';
  document.getElementById('odevDurumu').value = '';
  document.getElementById('buHaftaKonu').value = '';
  document.getElementById('gelecekHaftaOdev').value = '';
  document.getElementById('gelecekTarih').value = '';
  document.getElementById('gelecekHaftaKonu').value = '';
  document.getElementById('haftaDurumMesaji').innerText = '';
}

function doldurHaftaOgrenciListesi() {
  const select = document.getElementById('haftaOgrenci');
  const ogrenciler = JSON.parse(localStorage.getItem('ogrenciler') || '[]');
  select.innerHTML = '<option value=\"\">Öğrenci Seçin</option>' +
    ogrenciler.map(o => `<option value=\"${o.ad}\">${o.ad}</option>`).join('');
}

document.getElementById('haftaOgrenci').addEventListener('change', function () {
  const secili = this.value;
  const tumOdevler = JSON.parse(localStorage.getItem('odevler') || '[]');
  const odevler = tumOdevler.filter(o => o.ogrenci === secili);
  const select = document.getElementById('haftaOdev');
  select.innerHTML = '<option value=\"\">Ödev Seçin</option>' +
    odevler.map((o, i) => `<option value=\"${o.icerik}\">${o.tarih} - ${o.icerik}</option>`).join('');
});

window.addEventListener('load', doldurHaftaOgrenciListesi);
    let guncellenecekId = null;

    function switchTab(id, el) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tabBtn').forEach(btn => btn.classList.remove('active'));
  el.classList.add('active');
}

    function temizleInputlar() {
      document.getElementById('ogrenciAd').value = '';
      document.getElementById('ogrenciSinif').value = '';
    }

    function getOgrenciler() {
      return JSON.parse(localStorage.getItem('ogrenciler') || '[]');
    }

    function setOgrenciler(data) {
      localStorage.setItem('ogrenciler', JSON.stringify(data));
    }

    function ogrenciEkle() {
  const ad = document.getElementById('ogrenciAd').value.trim();
  const sinif = document.getElementById('ogrenciSinif').value.trim();
  if (!ad || !sinif) {
    alert('Lütfen tüm alanları doldurun.');
    return;
  }
  const ogrenciler = getOgrenciler();
  const id = 'ogr_' + Date.now();
  ogrenciler.push({ id, ad, sinif });
  setOgrenciler(ogrenciler);
  temizleInputlar();
  ogrenciListele();

  // 👇 Dropdown listeleri de güncellensin:
  if (typeof doldurOgrenciSecimi === 'function') doldurOgrenciSecimi();
  if (typeof doldurHaftaOgrenciListesi === 'function') doldurHaftaOgrenciListesi();
  if (typeof raporOgrenciListesiDoldur === 'function') raporOgrenciListesiDoldur();
}

    function ogrenciSil(id) {
  if (!confirm('Öğrenci ve ona ait tüm veriler silinsin mi?')) return;

  const ogrenciler = getOgrenciler();
  const silinenOgrenci = ogrenciler.find(o => o.id === id);
  const silinenAd = silinenOgrenci?.ad || '';

  // 1. Öğrenci listesi güncelle
  const yeniOgrenciler = ogrenciler.filter(o => o.id !== id);
  setOgrenciler(yeniOgrenciler);

  // 2. Ödevleri temizle (ogrenciId veya ogrenci adı)
  let odevler = JSON.parse(localStorage.getItem('odevler') || '[]');
  odevler = odevler.filter(o => o.ogrenciId !== id && o.ogrenci !== silinenAd);
  localStorage.setItem('odevler', JSON.stringify(odevler));

  // 3. Haftalık kayıtları temizle
  let haftalikKayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  haftalikKayitlar = haftalikKayitlar.filter(k => k.ogrenci !== silinenAd);
  localStorage.setItem('haftalikKayitlar', JSON.stringify(haftalikKayitlar));

  // 4. Tüm listeleri ve arayüz öğelerini güncelle
  ogrenciListele();
  haftalikKayitlariListele(); // öğrencinin kayıtları da arayüzden kalksın
  if (typeof doldurOgrenciSecimi === 'function') doldurOgrenciSecimi();
  if (typeof doldurHaftaOgrenciListesi === 'function') doldurHaftaOgrenciListesi();
  if (typeof raporOgrenciListesiDoldur === 'function') raporOgrenciListesiDoldur();
  if (typeof odevListele === 'function') odevListele();
  if (typeof haftalikFormYenile === 'function') haftalikFormYenile();

  // 5. Seçili öğrencileri sıfırla (form temizliği)
  ['odevOgrenci', 'haftaOgrenci', 'raporOgrenciSec'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // 6. Kullanıcıya bilgi ver
  alert(`✅ ${silinenAd} adlı öğrenci ve tüm ilişkili veriler tamamen silindi.`);
}

    function ogrenciGuncelle(id) {
      const ogrenciler = getOgrenciler();
      const ogrenci = ogrenciler.find(o => o.id === id);
      if (ogrenci) {
        guncellenecekId = id;
        document.getElementById('guncelleAd').value = ogrenci.ad;
        document.getElementById('guncelleSinif').value = ogrenci.sinif;
        document.getElementById('modalArkaPlan').style.display = 'block';
        document.getElementById('guncelleModal').style.display = 'block';
      }
    }

    function modalKapat() {
      document.getElementById('modalArkaPlan').style.display = 'none';
      document.getElementById('guncelleModal').style.display = 'none';
    }

    function ogrenciGuncelleKaydet() {
      const yeniAd = document.getElementById('guncelleAd').value.trim();
      const yeniSinif = document.getElementById('guncelleSinif').value.trim();
      if (!yeniAd || !yeniSinif) {
        alert('Lütfen tüm alanları doldurun.');
        return;
      }
      let ogrenciler = getOgrenciler();
      const index = ogrenciler.findIndex(o => o.id === guncellenecekId);
      if (index !== -1) {
        ogrenciler[index].ad = yeniAd;
        ogrenciler[index].sinif = yeniSinif;
        setOgrenciler(ogrenciler);
        ogrenciListele();
        modalKapat();
      }
    }

    function ogrenciListele() {
      const listeDiv = document.getElementById('ogrenciListesi');
      const ogrenciler = getOgrenciler();
      if (ogrenciler.length === 0) {
        listeDiv.innerHTML = '<p>Henüz kayıtlı öğrenci yok.</p>';
        return;
      }
      listeDiv.innerHTML = ogrenciler.map(o => `
        <div class="student-entry">
          <span>${o.ad} (${o.sinif})</span>
          <div>
            <button class="btn-small" onclick="ogrenciSil('${o.id}')">🗑️</button>
            <button class="btn-small" onclick="ogrenciGuncelle('${o.id}')">✏️</button>
          </div>
        </div>
      `).join('');
    }

    function verileriYedekle() {
  const data = {
    ogrenciler: JSON.parse(localStorage.getItem('ogrenciler') || '[]'),
    odevler: JSON.parse(localStorage.getItem('odevler') || '[]'),
    haftalikKayitlar: JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]') // eklendi
  };
  const dosyaAdi = document.getElementById('dosyaAdi').value.trim() || 'ozel_ders_yedek';
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = dosyaAdi + '.json';
  a.click();
  document.getElementById('yedekDurum').innerText = `📂 '${dosyaAdi}.json' dosyası indirildi. Lütfen bilgisayarınızın Downloads klasörünü kontrol edin.`;
}
    function verileriYukle(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      if (data.ogrenciler && data.odevler) {
        localStorage.setItem('ogrenciler', JSON.stringify(data.ogrenciler));
        localStorage.setItem('odevler', JSON.stringify(data.odevler));

        if (data.haftalikKayitlar) {
          localStorage.setItem('haftalikKayitlar', JSON.stringify(data.haftalikKayitlar));
        }

        document.getElementById('yedekDurum').innerText = '✅ Yedek başarıyla yüklendi!';
        ogrenciListele();
      } else {
        document.getElementById('yedekDurum').innerText = '⚠️ Geçersiz dosya formatı!';
      }
    } catch {
      document.getElementById('yedekDurum').innerText = '❌ Yükleme sırasında hata oluştu!';
    }
  };
  reader.readAsText(file);
}
  window.onload = ogrenciListele;
  window.addEventListener('load', () => {
  haftalikKayitlariListele();
});
  </script>
</body>
</html>