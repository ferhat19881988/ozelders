<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ã–zel Ders Takip Sistemi</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      color: #333;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tabs button {
  font-size: 13px;
  line-height: 1.2;
  white-space: normal; /* metin sarÄ±labilir */
  width: 100px;
}
    .tabs button.active {
      border-color: #333;
      background: #ddd;
    }
    section {
      display: none;
      background: white;
      border-radius: 10px;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    section.active {
      display: block;
    }
    input, select, textarea, button {
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #ddd;
    }
    .btn-small {
      width: auto;
      margin: 0 5px;
      padding: 6px 12px;
    }
    .icon {
      font-size: 16px;
      margin-right: 5px;
    }
    .student-entry {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    .student-entry span {
      flex: 1;
      text-align: left;
    }
    #guncelleModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      display: none;
      z-index: 1000;
      width: 90%;
      max-width: 400px;
    }
    #modalArkaPlan {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      display: none;
      z-index: 999;
    }
    #haftalikKayitListesi,
#odevListesi {
  max-height: 300px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  background: #fafafa;
}
#qrCanvasContainer {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 10px auto;
  width: 100%;
}

  </style>
</head>
<body>
  <h1>ğŸ“˜ Ã–zel Ders Takip Sistemi</h1>  <div class="tabs">
 <button class="tabBtn" onclick="switchTab('ogrenciKayit', this)">ğŸ‘¤ Ã–ÄŸrenci KaydÄ±</button>
<button class="tabBtn" onclick="switchTab('haftalikDegerlendirme', this)">ğŸ“… HaftalÄ±k DeÄŸerlendirme</button>
<button class="tabBtn" onclick="switchTab('whatsappRapor', this)">ğŸ“¤ WhatsApp Rapor</button>
<button class="tabBtn" onclick="switchTab('veriYonetimi', this)">ğŸ’¾ Veri Yedekleme</button>
  </div>  <section id="ogrenciKayit" class="active">
    <h2>ğŸ‘¤ Ã–ÄŸrenci KaydÄ±</h2>
    <input type="text" id="ogrenciAd" placeholder="Ã–ÄŸrenci AdÄ±">
    <select id="ogrenciSinif">
      <option value="">SÄ±nÄ±f SeÃ§iniz</option>
      <option value="5. SÄ±nÄ±f">5. SÄ±nÄ±f</option>
      <option value="6. SÄ±nÄ±f">6. SÄ±nÄ±f</option>
      <option value="7. SÄ±nÄ±f">7. SÄ±nÄ±f</option>
      <option value="8. SÄ±nÄ±f">8. SÄ±nÄ±f</option>
    </select>
    <div style="display: flex; gap: 10px;">
      <button onclick="ogrenciEkle()">â• Ã–ÄŸrenci Ekle</button>
      <button onclick="temizleInputlar()">ğŸ”„ Yenile</button>
    </div>
    <div id="ogrenciListesi"></div>
    <hr>
<h3>ğŸ“˜ Ã–dev Ekle</h3>

<select id="odevOgrenci">
  <option value="">Ã–ÄŸrenci SeÃ§iniz</option>
</select>

<input type="date" id="odevTarih">
<textarea id="odevIcerik" placeholder="Ã–dev iÃ§eriÄŸi girin..."></textarea>

<div style="display: flex; gap: 10px;">
  <button onclick="odevEkle()">â• Ã–dev Ekle</button>
  <button onclick="odevFormTemizle()">ğŸ”„ Yenile</button>
  <button onclick="tumOdevleriSil()">ğŸ—‘ï¸ TÃ¼m Ã–devleri Sil</button>
</div>

<div id="odevListesi"></div>
  </section>  <section id="veriYonetimi">
    <h2>ğŸ’¾ Verileri Yedekle & Geri YÃ¼kle</h2>
    <input type="text" id="dosyaAdi" placeholder="Dosya adÄ± girin (Ã¶rn: yedek-temmuz)">
    <div>
      <button onclick="verileriYedekle()">â¬‡ï¸ Verileri DÄ±ÅŸa Aktar</button>
      <input type="file" id="yedekDosya" style="display:none" onchange="verileriYukle(event)">
      <button onclick="document.getElementById('yedekDosya').click()">â¬†ï¸ YedeÄŸi Geri YÃ¼kle</button>
    </div>
    <p id="yedekDurum"></p>
  </section>  <div id="modalArkaPlan" onclick="modalKapat()"></div>
  <div id="guncelleModal">
    <h3>âœï¸ Ã–ÄŸrenci GÃ¼ncelle</h3>
    <input type="text" id="guncelleAd">
    <select id="guncelleSinif">
      <option value="">SÄ±nÄ±f SeÃ§iniz</option>
      <option value="5. SÄ±nÄ±f">5. SÄ±nÄ±f</option>
      <option value="6. SÄ±nÄ±f">6. SÄ±nÄ±f</option>
      <option value="7. SÄ±nÄ±f">7. SÄ±nÄ±f</option>
      <option value="8. SÄ±nÄ±f">8. SÄ±nÄ±f</option>
    </select>
    <button onclick="ogrenciGuncelleKaydet()">ğŸ’¾ Kaydet</button>
    <button onclick="modalKapat()">âŒ Kapat</button>
  </div>  
  <section id="haftalikDegerlendirme">
  <h2>ğŸ“… HaftalÄ±k DeÄŸerlendirme</h2>

  <select id="haftaOgrenci">
    <option value="">Ã–ÄŸrenci SeÃ§in</option>
  </select>

  <select id="haftaOdev">
    <option value="">Ã–dev SeÃ§in</option>
  </select>

  <select id="odevDurumu">
    <option value="">Ã–dev Durumu</option>
    <option value="yapti">âœ… YaptÄ±</option>
    <option value="yapmadi">âŒ YapmadÄ±</option>
    <option value="eksik">âš ï¸ Eksik</option>
    <option value="getirmedi">ğŸ“­ Getirmedi</option>
  </select>

  <textarea id="buHaftaKonu" placeholder="Bu hafta iÅŸlenen konu"></textarea>
  <textarea id="gelecekHaftaOdev" placeholder="Gelecek haftanÄ±n Ã¶devi"></textarea>
  <input type="date" id="gelecekTarih">
  <textarea id="gelecekHaftaKonu" placeholder="Gelecek hafta iÅŸlenecek konu"></textarea>

  <button onclick="haftalikVeriyiEkle()">â• Ã–devi Sisteme Ekle</button>
  <button onclick="haftalikVeriyiKaydet()">ğŸ’¾ TÃ¼mÃ¼nÃ¼ Kaydet</button>
  <button onclick="haftalikFormYenile()">ğŸ”„ Yenile</button>
<hr>
<h3>ğŸ“‹ KayÄ±tlÄ± HaftalÄ±k DeÄŸerlendirmeler</h3>
<div id="haftalikKayitListesi"></div>
  <p id="haftaDurumMesaji"></p>
</section>
  <div id="odevModalArkaPlan" onclick="odevModalKapat()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999;"></div>

<div id="odevGuncelleModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; padding:20px; border-radius:10px; max-width:400px; width:90%; z-index:1000;">
  <h3>âœï¸ Ã–dev GÃ¼ncelle</h3>
  <input type="date" id="guncelleOdevTarih">
  <textarea id="guncelleOdevIcerik" rows="4"></textarea>
  <button onclick="odevGuncelleKaydet()">ğŸ’¾ Kaydet</button>
  <button onclick="odevModalKapat()">âŒ Kapat</button>
</div>
  <!-- WhatsApp Rapor Sekmesi BaÅŸlangÄ±cÄ± -->
  <section id="whatsappRapor">
  <h2>ğŸ“¤ WhatsApp RaporlarÄ±</h2>  <div style="margin-bottom: 20px;">
    <label for="raporTipi"><strong>Rapor TÃ¼rÃ¼:</strong></label>
    <select id="raporTipi" onchange="raporTipiDegisti()">
      <option value="haftalik">ğŸ“… HaftalÄ±k Rapor</option>
      <option value="aylik">ğŸ“† AylÄ±k Rapor</option>
    </select>
  </div>  <!-- Ortak Ã–ÄŸrenci SeÃ§imi -->  <div style="margin-bottom: 15px;">
    <label for="raporOgrenciSec">ğŸ‘¤ Ã–ÄŸrenci SeÃ§:</label>
    <select id="raporOgrenciSec"></select>
  </div> 
    <!-- Mesaj Ã–nizleme AlanÄ± -->  <div>
    <label><strong>ğŸ“„ OluÅŸturulan Mesaj:</strong></label>
    <textarea id="raporMesaj" rows="12"></textarea></div>  <!-- GÃ¶nder Butonu -->
    <button onclick="whatsappMesajGonder()">ğŸ“¤ GÃ¶nder</button>
    <button onclick="raporFormYenile()">ğŸ”„ Yenile</button>
    <button onclick="qrKodModalAc()">ğŸ“± QR Kod ile GÃ¶ster</button>
<div id="qrCanvasContainer"></div>
</section>
<!-- WhatsApp Rapor Sekmesi Sonu -->
  <!-- HaftalÄ±k KayÄ±t GÃ¼ncelle ModalÄ± -->
<div id="haftalikModalArkaPlan" onclick="haftalikModalKapat()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:999;"></div>

<div id="haftalikGuncelleModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; padding:20px; border-radius:10px; max-width:450px; width:90%; z-index:1000;">
  <h3>âœï¸ HaftalÄ±k KayÄ±t GÃ¼ncelle</h3>
  <input type="text" id="guncelleHaftaOgrenci" placeholder="Ã–ÄŸrenci AdÄ±">
  <input type="text" id="guncelleHaftaKonu" placeholder="Bu hafta konusu">
  <input type="text" id="guncelleHaftaOdev" placeholder="Ã–dev">
  <input type="text" id="guncelleHaftaDurum" placeholder="Ã–dev durumu (yapti, yapmadi...)">
  <input type="date" id="guncelleHaftaTarih">
  <input type="text" id="guncelleGelecekKonu" placeholder="Gelecek hafta konusu">
  <input type="text" id="guncelleGelecekOdev" placeholder="Gelecek hafta Ã¶devi">
  <button onclick="haftalikKaydiGuncelleKaydet()">ğŸ’¾ Kaydet</button>
  <button onclick="haftalikModalKapat()">âŒ Kapat</button>
</div>

  <script>
function qrKodModalAc() {
  const mesaj = document.getElementById('raporMesaj').value.trim();
  if (!mesaj) return alert("Mesaj boÅŸ.");
  const url = `https://wa.me/?text=${encodeURIComponent(mesaj)}`;

  const container = document.getElementById('qrCanvasContainer');
  container.innerHTML = '';
  new QRCode(container, {
    text: url,
    width: 250,
    height: 250,
    correctLevel: QRCode.CorrectLevel.M
  });

  document.getElementById('qrModalArkaPlan').style.display = 'block';
  document.getElementById('qrModal').style.display = 'block';
}

    
   function raporFormYenile() {
  document.getElementById('raporTipi').value = 'haftalik';
  document.getElementById('raporOgrenciSec').value = '';
  document.getElementById('raporMesaj').value = '';
}

   
  let guncellenecekHaftaIndex = null;

function haftalikKaydiGuncelle(index) {
  const kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  const k = kayitlar[index];
  guncellenecekHaftaIndex = index;
  document.getElementById('guncelleHaftaOgrenci').value = k.ogrenci || '';
  document.getElementById('guncelleHaftaKonu').value = k.konu || '';
  document.getElementById('guncelleHaftaOdev').value = k.odev || '';
  document.getElementById('guncelleHaftaDurum').value = k.durum || '';
  document.getElementById('guncelleHaftaTarih').value = k.tarih || '';
  document.getElementById('guncelleGelecekKonu').value = k.gelecekKonu || '';
  document.getElementById('guncelleGelecekOdev').value = k.gelecekOdev || '';
  document.getElementById('haftalikModalArkaPlan').style.display = 'block';
  document.getElementById('haftalikGuncelleModal').style.display = 'block';
}

function haftalikKaydiGuncelleKaydet() {
  const kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  if (guncellenecekHaftaIndex === null) return;

  kayitlar[guncellenecekHaftaIndex] = {
    ogrenci: document.getElementById('guncelleHaftaOgrenci').value,
    konu: document.getElementById('guncelleHaftaKonu').value,
    odev: document.getElementById('guncelleHaftaOdev').value,
    durum: document.getElementById('guncelleHaftaDurum').value,
    tarih: document.getElementById('guncelleHaftaTarih').value,
    gelecekKonu: document.getElementById('guncelleGelecekKonu').value,
    gelecekOdev: document.getElementById('guncelleGelecekOdev').value,
    zaman: new Date().toISOString()
  };

  localStorage.setItem('haftalikKayitlar', JSON.stringify(kayitlar));
  haftalikModalKapat();
  haftalikKayitlariListele();
}

function haftalikModalKapat() {
  document.getElementById('haftalikModalArkaPlan').style.display = 'none';
  document.getElementById('haftalikGuncelleModal').style.display = 'none';
  guncellenecekHaftaIndex = null;
}
  
  function haftalikKaydiSil(index) {
  if (!confirm("Bu haftalÄ±k kayÄ±t silinsin mi?")) return;
  let kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  kayitlar.splice(index, 1);
  localStorage.setItem('haftalikKayitlar', JSON.stringify(kayitlar));
  haftalikKayitlariListele();
}
  
function haftalikKayitlariListele() {
  const liste = document.getElementById('haftalikKayitListesi');
  const kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');

  if (kayitlar.length === 0) {
    liste.innerHTML = '<p>HenÃ¼z haftalÄ±k deÄŸerlendirme yapÄ±lmamÄ±ÅŸ.</p>';
    return;
  }

  // SÄ±ralama: Yeni en Ã¼stte
  kayitlar.sort((a, b) => new Date(b.zaman || b.tarih) - new Date(a.zaman || a.tarih));

  liste.innerHTML = kayitlar.map((k, i) => `
    <div class="student-entry">
      <span>
        ğŸ‘¤ <b>${k.ogrenci}</b><br>
        ğŸ“Œ Konu: ${k.konu || '-'}<br>
        ğŸ“… Tarih: ${k.tarih || '-'}<br>
        ğŸ“˜ Ã–dev: ${k.odev || '-'} (${k.durum || 'Durum yok'})<br>
        â¡ï¸ Gelecek Hafta: ${k.gelecekKonu || '-'} / ${k.gelecekOdev || '-'}
      </span>
      <div>
        <button class="btn-small" onclick="haftalikKaydiSil(${i})">ğŸ—‘ï¸</button>
        <button class="btn-small" onclick="haftalikKaydiGuncelle(${i})">âœï¸</button>
      </div>
    </div>
  `).join('');
}

  
  function raporTipiDegisti() {
  const raporTipi = document.getElementById('raporTipi').value;
  const aylikSecimAlani = document.getElementById('aylikSecimAlani');
  aylikSecimAlani.style.display = (raporTipi === 'aylik') ? 'block' : 'none';
  raporMesajiOlustur();
}

function whatsappMesajGonder() {
  const mesaj = document.getElementById('raporMesaj').value.trim();
  if (!mesaj) return alert('GÃ¶nderilecek mesaj boÅŸ.');
  const url = `https://wa.me/?text=${encodeURIComponent(mesaj)}`;
  window.open(url, '_blank');
}

function raporMesajiOlustur() {
  const tip = document.getElementById('raporTipi').value;
  const secilenId = document.getElementById('raporOgrenciSec').value;
  const ogrenciler = JSON.parse(localStorage.getItem('ogrenciler') || '[]');
  const haftalikKayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  const ogrenci = ogrenciler.find(o => o.id === secilenId);
  if (!ogrenci) return;

  const ayAdlari = ['Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];
  const formatTarih = (date) => `${date.getDate()} ${ayAdlari[date.getMonth()]} ${date.getFullYear()}`;
  const toShortDateStr = (d) => new Date(d).toISOString().split('T')[0];

  const bugun = new Date();
  const bugunStr = toShortDateStr(bugun);
  const birAyOnce = new Date(bugun);
  birAyOnce.setMonth(birAyOnce.getMonth() - 1);
  const birAyOnceStr = toShortDateStr(birAyOnce);

  const durumIcon = (durum) => {
    switch ((durum || '').toLowerCase()) {
      case 'yapti': return 'âœ… YaptÄ±';
      case 'yapmadi': return 'âŒ YapmadÄ±';
      case 'eksik': return 'âš ï¸ Eksik';
      case 'getirmedi': return 'ğŸ“­ Getirmedi';
      default: return 'â– Bilgi Yok';
    }
  };

  const ogrenciAdi = ogrenci.ad;

  if (tip === 'haftalik') {
    const kayitlar = haftalikKayitlar.filter(k => k.ogrenci === ogrenciAdi);
    const sonKayit = kayitlar[kayitlar.length - 1];

    const mesaj = `ğŸ“˜ Ã–zel Ders Takip Sistemi
ğŸ“… *Tarih:* ${formatTarih(bugun)}
ğŸ‘¤ *Ã–ÄŸrenci:* ${ogrenciAdi}
ğŸ“ *Ã–ÄŸretmen:* Ferhat KaragÃ¶z

ğŸ“Œ *Bu Hafta YapÄ±lanlar*
ğŸ“š *Ä°ÅŸlenen Konu:* ${sonKayit?.konu || 'Bilgi Yok'}
ğŸ“ *GeÃ§en Haftaki Ã–dev:* ${sonKayit?.odev || 'Ã–dev Yok'} â†’ ${durumIcon(sonKayit?.durum)}

ğŸ“– *Gelecek Hafta YapÄ±lacaklar*
ğŸ“ *Ã–dev:* ${sonKayit?.gelecekOdev || 'Ã–dev Yok'}
â° *Teslim Tarihi:* ${sonKayit?.tarih ? formatTarih(new Date(sonKayit.tarih)) : 'Tarih Yok'}
ğŸ“š *Ä°ÅŸlenecek Konular:* ${sonKayit?.gelecekKonu || 'Konu Yok'}

SaygÄ±larÄ±mÄ±zla, bilginize.`;

    document.getElementById('raporMesaj').value = mesaj;

  } else if (tip === 'aylik') {
    // SÄ±ralanmÄ±ÅŸ ÅŸekilde alÄ±nan son 1 aylÄ±k kayÄ±tlar (yeni â†’ eski)
    const tarihAraligindakiKayitlar = haftalikKayitlar
      .filter(k => {
        const ogr = k.ogrenci === ogrenciAdi;
        const tarihStr = toShortDateStr(k.zaman || k.tarih);
        return ogr && tarihStr >= birAyOnceStr && tarihStr <= bugunStr;
      })
      .sort((a, b) => {
        const tA = new Date(a.zaman || a.tarih);
        const tB = new Date(b.zaman || b.tarih);
        return tB - tA; // Yeni tarih baÅŸta
      });

    const konular = tarihAraligindakiKayitlar.map(k => {
      const t = new Date(k.zaman || k.tarih);
      return `- ${formatTarih(t)} â†’ ${k.konu || 'Konu girilmemiÅŸ'}`;
    });

    const odevSatirlari = tarihAraligindakiKayitlar.map(k => {
      const t = new Date(k.zaman || k.tarih);
      return `- ${formatTarih(t)} â†’ ${k.odev || 'Ã–dev Yok'} â†’ ${durumIcon(k.durum)}`;
    });

    const toplamOdev = tarihAraligindakiKayitlar.filter(k => k.odev).length;
    const yapilanOdev = tarihAraligindakiKayitlar.filter(k => (k.durum || '').toLowerCase() === 'yapti').length;
    const oran = toplamOdev ? Math.round((yapilanOdev / toplamOdev) * 100) : 0;

    const mesaj = `ğŸ“˜ Ã–zel Ders Takip Sistemi
ğŸ“… *Tarih:* ${formatTarih(bugun)}
ğŸ‘¤ *Ã–ÄŸrenci:* ${ogrenciAdi}
ğŸ“ *Ã–ÄŸretmen:* Ferhat KaragÃ¶z

ğŸ“… *Son 1 Ayda YapÄ±lanlar* (${formatTarih(birAyOnce)} - ${formatTarih(bugun)})

ğŸ“š *Ä°ÅŸlenen Konular:*
${konular.length ? konular.join("\n") : '- Veri yok'}

ğŸ“ *Verilen Ã–devler ve Kontrolleri:*
${odevSatirlari.length ? odevSatirlari.join("\n") : '- Veri yok'}

ğŸ“Š *Ã–dev PerformansÄ±*
- *Toplam Ã–dev:* ${toplamOdev}
- *Tamamlanan:* ${yapilanOdev}
- *BaÅŸarÄ± OranÄ±:* %${oran}

*Bu rapor, son bir ay iÃ§inde iÅŸlenen tÃ¼m konularÄ± ve Ã¶dev takibini iÃ§ermektedir.*

SaygÄ±larÄ±mÄ±zla, bilginize.`;

    document.getElementById('raporMesaj').value = mesaj;
  }
}



function raporOgrenciListesiDoldur() {
  const sec = document.getElementById('raporOgrenciSec');
  sec.innerHTML = '<option value="">-- SeÃ§iniz --</option>';
  const liste = JSON.parse(localStorage.getItem('ogrenciler') || '[]');
  liste.forEach(o => {
    const opt = document.createElement('option');
    opt.value = o.id;
    opt.textContent = o.ad + ' (' + o.sinif + ')';
    sec.appendChild(opt);
  });
}

window.addEventListener('load', () => {
  raporOgrenciListesiDoldur();
  document.getElementById('raporTipi').addEventListener('change', raporMesajiOlustur);
  document.getElementById('raporOgrenciSec').addEventListener('change', raporMesajiOlustur);
  document.getElementById('raporAy').addEventListener('change', raporMesajiOlustur);
});
  let guncellenecekOdevIndex = null;

function odevGuncelleModalAc(index) {
  const odevler = getOdevler();
  const o = odevler[index];
  guncellenecekOdevIndex = index;
  document.getElementById('guncelleOdevTarih').value = o.tarih;
  document.getElementById('guncelleOdevIcerik').value = o.icerik;
  document.getElementById('odevModalArkaPlan').style.display = 'block';
  document.getElementById('odevGuncelleModal').style.display = 'block';
}

function odevModalKapat() {
  document.getElementById('odevModalArkaPlan').style.display = 'none';
  document.getElementById('odevGuncelleModal').style.display = 'none';
}

function odevGuncelleKaydet() {
  const yeniTarih = document.getElementById('guncelleOdevTarih').value;
  const yeniIcerik = document.getElementById('guncelleOdevIcerik').value.trim();
  if (!yeniTarih || !yeniIcerik) {
    alert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.');
    return;
  }

  const odevler = getOdevler();
  if (guncellenecekOdevIndex !== null) {
    odevler[guncellenecekOdevIndex].tarih = yeniTarih;
    odevler[guncellenecekOdevIndex].icerik = yeniIcerik;
    setOdevler(odevler);
    odevListele();
    odevModalKapat();
  }
}
  
  function getOdevler() {
  return JSON.parse(localStorage.getItem('odevler') || '[]');
}

function setOdevler(data) {
  localStorage.setItem('odevler', JSON.stringify(data));
}

function odevEkle() {
  const ogrenci = document.getElementById('odevOgrenci').value;
  const tarih = document.getElementById('odevTarih').value;
  const icerik = document.getElementById('odevIcerik').value.trim();

  if (!ogrenci || !tarih || !icerik) {
    alert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.');
    return;
  }

  const odevler = getOdevler();
  odevler.push({ ogrenci, tarih, icerik });
  setOdevler(odevler);
  odevFormTemizle();
  odevListele();
}

function odevSil(index) {
  if (!confirm('Bu Ã¶dev silinsin mi?')) return;
  const odevler = getOdevler();
  odevler.splice(index, 1);
  setOdevler(odevler);
  odevListele();
}

function tumOdevleriSil() {
  if (!confirm('TÃ¼m Ã¶devler silinsin mi?')) return;
  localStorage.removeItem('odevler');
  odevListele();
}

function odevFormTemizle() {
  document.getElementById('odevOgrenci').value = '';
  document.getElementById('odevTarih').value = '';
  document.getElementById('odevIcerik').value = '';
}

function odevListele() {
  const liste = document.getElementById('odevListesi');
  const odevler = getOdevler();

  if (odevler.length === 0) {
    liste.innerHTML = '<p>HenÃ¼z Ã¶dev girilmedi.</p>';
    return;
  }

  // SÄ±ralama: Yeni en Ã¼stte
  odevler.sort((a, b) => new Date(b.tarih) - new Date(a.tarih));

  liste.innerHTML = odevler.map((o, i) => `
    <div class="student-entry">
      <span><b>${o.ogrenci}</b> - ${o.tarih} <br> ${o.icerik}</span>
      <div>
        <button class="btn-small" onclick="odevSil(${i})">ğŸ—‘ï¸</button>
        <button class="btn-small" onclick="odevGuncelleModalAc(${i})">âœï¸</button>
      </div>
    </div>
  `).join('');
}


function doldurOgrenciSecimi() {
  const ogrenciler = JSON.parse(localStorage.getItem('ogrenciler') || '[]');
  const select = document.getElementById('odevOgrenci');
  if (!select) return;
  select.innerHTML = '<option value=\"\">Ã–ÄŸrenci SeÃ§iniz</option>' +
    ogrenciler.map(o => `<option value=\"${o.ad}\">${o.ad}</option>`).join('');
}

window.addEventListener('load', () => {
  doldurOgrenciSecimi();
  odevListele();
});
  
  function haftalikVeriyiEkle() {
  const ogrenci = document.getElementById('haftaOgrenci').value;
  const odevIcerik = document.getElementById('gelecekHaftaOdev').value.trim();
  const tarih = document.getElementById('gelecekTarih').value;

  if (!ogrenci || !odevIcerik || !tarih) {
    alert('Ã–ÄŸrenci, Ã¶dev ve tarih girilmelidir.');
    return;
  }

  // Ã–devi haftalÄ±k sisteme ekleme (ayrÄ±ca localStorage'da saklanan haftalÄ±k kayÄ±tlara dahil edilebilir)
  const odevler = JSON.parse(localStorage.getItem('odevler') || '[]');
  odevler.push({ ogrenci, tarih, icerik: odevIcerik });
  localStorage.setItem('odevler', JSON.stringify(odevler));

  // Liste gÃ¼ncellensin (eÄŸer varsa)
  if (typeof odevListele === 'function') {
    odevListele();
  }

  document.getElementById('haftaDurumMesaji').innerText = 'âœ… Ã–dev sisteme kaydedildi.';
}

function haftalikVeriyiKaydet() {
  const data = {
    ogrenci: document.getElementById('haftaOgrenci').value,
    odev: document.getElementById('haftaOdev').value,
    durum: document.getElementById('odevDurumu').value,
    konu: document.getElementById('buHaftaKonu').value.trim(),
    gelecekOdev: document.getElementById('gelecekHaftaOdev').value.trim(),
    tarih: document.getElementById('gelecekTarih').value,
    gelecekKonu: document.getElementById('gelecekHaftaKonu').value.trim(),
    zaman: new Date().toISOString()
  };
  const kayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  kayitlar.push(data);
  localStorage.setItem('haftalikKayitlar', JSON.stringify(kayitlar));
  document.getElementById('haftaDurumMesaji').innerText = 'ğŸ’¾ KayÄ±t baÅŸarÄ±yla yapÄ±ldÄ±';
  haftalikKayitlariListele();
}

function haftalikFormYenile() {
  document.getElementById('haftaOgrenci').value = '';
  document.getElementById('haftaOdev').value = '';
  document.getElementById('odevDurumu').value = '';
  document.getElementById('buHaftaKonu').value = '';
  document.getElementById('gelecekHaftaOdev').value = '';
  document.getElementById('gelecekTarih').value = '';
  document.getElementById('gelecekHaftaKonu').value = '';
  document.getElementById('haftaDurumMesaji').innerText = '';
}

function doldurHaftaOgrenciListesi() {
  const select = document.getElementById('haftaOgrenci');
  const ogrenciler = JSON.parse(localStorage.getItem('ogrenciler') || '[]');
  select.innerHTML = '<option value=\"\">Ã–ÄŸrenci SeÃ§in</option>' +
    ogrenciler.map(o => `<option value=\"${o.ad}\">${o.ad}</option>`).join('');
}

document.getElementById('haftaOgrenci').addEventListener('change', function () {
  const secili = this.value;
  const tumOdevler = JSON.parse(localStorage.getItem('odevler') || '[]');
  const odevler = tumOdevler.filter(o => o.ogrenci === secili);
  const select = document.getElementById('haftaOdev');
  select.innerHTML = '<option value=\"\">Ã–dev SeÃ§in</option>' +
    odevler.map((o, i) => `<option value=\"${o.icerik}\">${o.tarih} - ${o.icerik}</option>`).join('');
});

window.addEventListener('load', doldurHaftaOgrenciListesi);
    let guncellenecekId = null;

    function switchTab(id, el) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tabBtn').forEach(btn => btn.classList.remove('active'));
  el.classList.add('active');
}

    function temizleInputlar() {
      document.getElementById('ogrenciAd').value = '';
      document.getElementById('ogrenciSinif').value = '';
    }

    function getOgrenciler() {
      return JSON.parse(localStorage.getItem('ogrenciler') || '[]');
    }

    function setOgrenciler(data) {
      localStorage.setItem('ogrenciler', JSON.stringify(data));
    }

    function ogrenciEkle() {
  const ad = document.getElementById('ogrenciAd').value.trim();
  const sinif = document.getElementById('ogrenciSinif').value.trim();
  if (!ad || !sinif) {
    alert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.');
    return;
  }
  const ogrenciler = getOgrenciler();
  const id = 'ogr_' + Date.now();
  ogrenciler.push({ id, ad, sinif });
  setOgrenciler(ogrenciler);
  temizleInputlar();
  ogrenciListele();

  // ğŸ‘‡ Dropdown listeleri de gÃ¼ncellensin:
  if (typeof doldurOgrenciSecimi === 'function') doldurOgrenciSecimi();
  if (typeof doldurHaftaOgrenciListesi === 'function') doldurHaftaOgrenciListesi();
  if (typeof raporOgrenciListesiDoldur === 'function') raporOgrenciListesiDoldur();
}

    function ogrenciSil(id) {
  if (!confirm('Ã–ÄŸrenci ve ona ait tÃ¼m veriler silinsin mi?')) return;

  const ogrenciler = getOgrenciler();
  const silinenOgrenci = ogrenciler.find(o => o.id === id);
  const silinenAd = silinenOgrenci?.ad || '';

  // 1. Ã–ÄŸrenci listesi gÃ¼ncelle
  const yeniOgrenciler = ogrenciler.filter(o => o.id !== id);
  setOgrenciler(yeniOgrenciler);

  // 2. Ã–devleri temizle (ogrenciId veya ogrenci adÄ±)
  let odevler = JSON.parse(localStorage.getItem('odevler') || '[]');
  odevler = odevler.filter(o => o.ogrenciId !== id && o.ogrenci !== silinenAd);
  localStorage.setItem('odevler', JSON.stringify(odevler));

  // 3. HaftalÄ±k kayÄ±tlarÄ± temizle
  let haftalikKayitlar = JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]');
  haftalikKayitlar = haftalikKayitlar.filter(k => k.ogrenci !== silinenAd);
  localStorage.setItem('haftalikKayitlar', JSON.stringify(haftalikKayitlar));

  // 4. TÃ¼m listeleri ve arayÃ¼z Ã¶ÄŸelerini gÃ¼ncelle
  ogrenciListele();
  haftalikKayitlariListele(); // Ã¶ÄŸrencinin kayÄ±tlarÄ± da arayÃ¼zden kalksÄ±n
  if (typeof doldurOgrenciSecimi === 'function') doldurOgrenciSecimi();
  if (typeof doldurHaftaOgrenciListesi === 'function') doldurHaftaOgrenciListesi();
  if (typeof raporOgrenciListesiDoldur === 'function') raporOgrenciListesiDoldur();
  if (typeof odevListele === 'function') odevListele();
  if (typeof haftalikFormYenile === 'function') haftalikFormYenile();

  // 5. SeÃ§ili Ã¶ÄŸrencileri sÄ±fÄ±rla (form temizliÄŸi)
  ['odevOgrenci', 'haftaOgrenci', 'raporOgrenciSec'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });

  // 6. KullanÄ±cÄ±ya bilgi ver
  alert(`âœ… ${silinenAd} adlÄ± Ã¶ÄŸrenci ve tÃ¼m iliÅŸkili veriler tamamen silindi.`);
}

    function ogrenciGuncelle(id) {
      const ogrenciler = getOgrenciler();
      const ogrenci = ogrenciler.find(o => o.id === id);
      if (ogrenci) {
        guncellenecekId = id;
        document.getElementById('guncelleAd').value = ogrenci.ad;
        document.getElementById('guncelleSinif').value = ogrenci.sinif;
        document.getElementById('modalArkaPlan').style.display = 'block';
        document.getElementById('guncelleModal').style.display = 'block';
      }
    }

    function modalKapat() {
      document.getElementById('modalArkaPlan').style.display = 'none';
      document.getElementById('guncelleModal').style.display = 'none';
    }

    function ogrenciGuncelleKaydet() {
      const yeniAd = document.getElementById('guncelleAd').value.trim();
      const yeniSinif = document.getElementById('guncelleSinif').value.trim();
      if (!yeniAd || !yeniSinif) {
        alert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.');
        return;
      }
      let ogrenciler = getOgrenciler();
      const index = ogrenciler.findIndex(o => o.id === guncellenecekId);
      if (index !== -1) {
        ogrenciler[index].ad = yeniAd;
        ogrenciler[index].sinif = yeniSinif;
        setOgrenciler(ogrenciler);
        ogrenciListele();
        modalKapat();
      }
    }

    function ogrenciListele() {
      const listeDiv = document.getElementById('ogrenciListesi');
      const ogrenciler = getOgrenciler();
      if (ogrenciler.length === 0) {
        listeDiv.innerHTML = '<p>HenÃ¼z kayÄ±tlÄ± Ã¶ÄŸrenci yok.</p>';
        return;
      }
      listeDiv.innerHTML = ogrenciler.map(o => `
        <div class="student-entry">
          <span>${o.ad} (${o.sinif})</span>
          <div>
            <button class="btn-small" onclick="ogrenciSil('${o.id}')">ğŸ—‘ï¸</button>
            <button class="btn-small" onclick="ogrenciGuncelle('${o.id}')">âœï¸</button>
          </div>
        </div>
      `).join('');
    }

    function verileriYedekle() {
  const data = {
    ogrenciler: JSON.parse(localStorage.getItem('ogrenciler') || '[]'),
    odevler: JSON.parse(localStorage.getItem('odevler') || '[]'),
    haftalikKayitlar: JSON.parse(localStorage.getItem('haftalikKayitlar') || '[]') // eklendi
  };
  const dosyaAdi = document.getElementById('dosyaAdi').value.trim() || 'ozel_ders_yedek';
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = dosyaAdi + '.json';
  a.click();
  document.getElementById('yedekDurum').innerText = `ğŸ“‚ '${dosyaAdi}.json' dosyasÄ± indirildi. LÃ¼tfen bilgisayarÄ±nÄ±zÄ±n Downloads klasÃ¶rÃ¼nÃ¼ kontrol edin.`;
}
    function verileriYukle(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      if (data.ogrenciler && data.odevler) {
        localStorage.setItem('ogrenciler', JSON.stringify(data.ogrenciler));
        localStorage.setItem('odevler', JSON.stringify(data.odevler));

        if (data.haftalikKayitlar) {
          localStorage.setItem('haftalikKayitlar', JSON.stringify(data.haftalikKayitlar));
        }

        document.getElementById('yedekDurum').innerText = 'âœ… Yedek baÅŸarÄ±yla yÃ¼klendi!';
        ogrenciListele();
      } else {
        document.getElementById('yedekDurum').innerText = 'âš ï¸ GeÃ§ersiz dosya formatÄ±!';
      }
    } catch {
      document.getElementById('yedekDurum').innerText = 'âŒ YÃ¼kleme sÄ±rasÄ±nda hata oluÅŸtu!';
    }
  };
  reader.readAsText(file);
}
  window.onload = ogrenciListele;
  window.addEventListener('load', () => {
  haftalikKayitlariListele();
});
  </script>
</body>
</html>